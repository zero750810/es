import{a,r as l,c as e,j as n,e as t,f as i,i as s,z as c,A as d,F as o,g as u,t as p,G as v,y as r,n as m,o as b}from"./vue-Cvy1YwU9.js";import{a as _,b as k,_ as h}from"./index-CETVKyUk.js";import"./vendor-B4ZmVpUI.js";const y={class:"supplier-view"},f={class:"page-header"},g={class:"supplier-layout"},w={class:"supplier-sidebar"},C={class:"search-section"},j={key:0,class:"loading-state"},I={key:1,class:"empty-state"},A={key:2,class:"supplier-list-compact"},L=["onClick"],V={class:"supplier-header"},x={class:"supplier-category"},D={class:"supplier-meta"},U={class:"supplier-phone"},S={class:"supplier-email"},N={class:"supplier-detail"},P={key:0,class:"detail-placeholder"},E={key:1,class:"detail-content"},z={class:"detail-section"},T={class:"section-header"},$={class:"section-actions"},q={class:"info-display-compact"},F={class:"info-grid-pairs"},G={class:"info-pair"},W={class:"info-item-compact"},B={class:"info-item-compact"},H={class:"info-pair"},J={class:"info-item-compact"},K={class:"info-item-compact"},M={class:"info-pair"},O={class:"info-item-compact"},Q={class:"bank-info-compact"},R={class:"bank-grid"},X={class:"bank-item"},Y={class:"bank-item"},Z={class:"bank-item"},aa={class:"detail-section"},la={class:"section-header"},ea={class:"count-badge"},na={key:0,class:"empty-state"},ta={key:1,class:"projects-table-compact"},ia=["onClick"],sa={class:"td-project"},ca={class:"td-client"},da={class:"td-amount"},oa={class:"td-date"},ua={class:"td-action"},pa=["onClick"],va={class:"modal-header"},ra={class:"form-group"},ma={class:"form-group"},ba={class:"form-group"},_a={class:"form-group"},ka={class:"form-group"},ha={class:"form-group"},ya={class:"form-group"},fa={class:"form-actions"},ga=["disabled"],wa=h(a({__name:"SupplierView",setup(a){const h=_(),wa=k(),Ca=l(!1),ja=l(!1),Ia=l(null),Aa=l(null),La=l(""),Va=l({name:"",line_id:"",email:"",phone:"",bank_name:"",bank_account:"",bank_code:"",tag_type:[]}),xa=e(()=>h.supplier||[]),Da=e(()=>wa.loading.value),Ua=e(()=>La.value?xa.value.filter(a=>a.name.toLowerCase().includes(La.value.toLowerCase())):xa.value),Sa=l([]),Na=e(()=>{if(!Aa.value)return[];const a=Sa.value.filter(a=>{var l;return a.supplier_id===(null==(l=Aa.value)?void 0:l.id)&&!a.deleted_at}),l=h.projectList||[],e=[...new Set(a.map(a=>a.project_id))];return l.filter(a=>e.includes(a.id)&&!a.deleted_at).map(l=>{const e=a.filter(a=>a.project_id===l.id).reduce((a,l)=>a+(l.pay||0),0);return{...l,supplierAmount:e}})}),Pa=()=>{Ca.value=!1,ja.value=!1,Ia.value=null,Va.value={name:"",line_id:"",email:"",phone:"",bank_name:"",bank_account:"",bank_code:"",tag_type:[]}},Ea=async()=>{try{Ca.value?await wa.callAPI({table:"supplier",action:"create",data:Va.value}):Ia.value&&await wa.callAPI({table:"supplier",action:"update",data:{id:Ia.value.id,...Va.value}}),await h.refreshData(),Pa()}catch(a){alert("儲存失敗，請稍後再試")}},za=a=>{if(!a.tag_type||0===a.tag_type.length)return"未分類";return(h.tags||[]).filter(l=>a.tag_type.includes(l.id)&&"supplier"===l.type).map(a=>a.name).join(", ")||"未分類"},Ta=a=>{const l=h.crmList.find(l=>l.id===String(a));return(null==l?void 0:l.name)||"未知客戶"},$a=a=>{window.open(`/project/${a.id}`,"_blank")};return n(async()=>{await h.refreshData(),await(async()=>{try{const a=await wa.callAPI({table:"project_detail",action:"read"});a&&Array.isArray(a)&&(Sa.value=a)}catch(a){}})()}),(a,l)=>(b(),t("div",y,[i("div",f,[l[13]||(l[13]=i("h1",null,"供應商管理",-1)),i("button",{onClick:l[0]||(l[0]=a=>Ca.value=!0),class:"add-btn"}," ➕ 新增供應商 ")]),i("div",g,[i("div",w,[i("div",C,[c(i("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>La.value=a),type:"text",placeholder:"搜尋供應商名稱...",class:"search-input"},null,512),[[d,La.value]])]),Da.value?(b(),t("div",j," 載入中... ")):0===Ua.value.length?(b(),t("div",I,[l[14]||(l[14]=i("div",{class:"empty-icon"},"🏭",-1)),l[15]||(l[15]=i("p",null,"尚未新增任何供應商",-1)),i("button",{onClick:l[2]||(l[2]=a=>Ca.value=!0),class:"add-btn-small"},"新增第一個供應商")])):(b(),t("div",A,[(b(!0),t(o,null,u(Ua.value,a=>{var l;return b(),t("div",{key:a.id,class:m(["supplier-item-compact",{active:(null==(l=Aa.value)?void 0:l.id)===a.id}]),onClick:l=>(a=>{Aa.value=a})(a)},[i("div",V,[i("h4",null,p(a.name),1),i("span",x,p(za(a)),1)]),i("div",D,[i("span",U,p(a.phone||"未設定電話"),1),i("span",S,p(a.email||"未設定信箱"),1)])],10,L)}),128))]))]),i("div",N,[Aa.value?(b(),t("div",E,[i("div",z,[i("div",T,[l[17]||(l[17]=i("h3",null,"基本資訊",-1)),i("div",$,[i("button",{onClick:l[3]||(l[3]=a=>{return l=Aa.value,Ia.value=l,Va.value={name:l.name||"",line_id:l.line_id||"",email:l.email||"",phone:l.phone||"",bank_name:l.bank_name||"",bank_account:l.bank_account||"",bank_code:l.bank_code||"",tag_type:l.tag_type||[]},void(ja.value=!0);var l}),class:"btn-edit"},"編輯"),i("button",{onClick:l[4]||(l[4]=a=>(async a=>{var l;if(confirm("確定要刪除此供應商嗎？"))try{await wa.callAPI({table:"supplier",action:"delete",data:{id:a}}),(null==(l=Aa.value)?void 0:l.id)===a&&(Aa.value=null),await h.refreshData()}catch(e){alert("刪除失敗，請稍後再試")}})(Aa.value.id)),class:"btn-delete"},"刪除")])]),i("div",q,[i("div",F,[i("div",G,[i("div",W,[l[18]||(l[18]=i("label",null,"供應商名稱",-1)),i("span",null,p(Aa.value.name),1)]),i("div",B,[l[19]||(l[19]=i("label",null,"供應商分類",-1)),i("span",null,p(za(Aa.value)),1)])]),i("div",H,[i("div",J,[l[20]||(l[20]=i("label",null,"聯絡電話",-1)),i("span",null,p(Aa.value.phone||"未設定"),1)]),i("div",K,[l[21]||(l[21]=i("label",null,"電子郵件",-1)),i("span",null,p(Aa.value.email||"未設定"),1)])]),i("div",M,[i("div",O,[l[22]||(l[22]=i("label",null,"LINE ID",-1)),i("span",null,p(Aa.value.line_id||"未設定"),1)])])]),i("div",Q,[l[26]||(l[26]=i("h5",null,"銀行資訊",-1)),i("div",R,[i("div",X,[l[23]||(l[23]=i("label",null,"銀行名稱",-1)),i("span",null,p(Aa.value.bank_name||"未設定"),1)]),i("div",Y,[l[24]||(l[24]=i("label",null,"銀行帳號",-1)),i("span",null,p(Aa.value.bank_account||"未設定"),1)]),i("div",Z,[l[25]||(l[25]=i("label",null,"銀行代碼",-1)),i("span",null,p(Aa.value.bank_code||"未設定"),1)])])])])]),i("div",aa,[i("div",la,[l[27]||(l[27]=i("h3",null,"相關專案",-1)),i("span",ea,p(Na.value.length),1)]),0===Na.value.length?(b(),t("div",na,l[28]||(l[28]=[i("p",null,"此供應商尚未參與任何專案",-1)]))):(b(),t("div",ta,[l[29]||(l[29]=v('<div class="table-header-compact" data-v-58b3eb72><div class="th-project" data-v-58b3eb72>專案名稱</div><div class="th-client" data-v-58b3eb72>客戶</div><div class="th-amount" data-v-58b3eb72>合作金額</div><div class="th-date" data-v-58b3eb72>建立日期</div><div class="th-action" data-v-58b3eb72>操作</div></div>',1)),(b(!0),t(o,null,u(Na.value,a=>{var l,e;return b(),t("div",{key:a.id,class:"table-row-compact",onClick:l=>$a(a)},[i("div",sa,p(a.project_name),1),i("div",ca,p(Ta(a.crm_id)),1),i("div",da,"NT$ "+p((null==(l=a.supplierAmount)?void 0:l.toLocaleString())||"0"),1),i("div",oa,p((e=a.created_at,new Date(e).toLocaleDateString("zh-TW"))),1),i("div",ua,[i("button",{class:"btn-icon-compact",onClick:r(l=>$a(a),["stop"])},"🔗",8,pa)])],8,ia)}),128))]))])])):(b(),t("div",P,l[16]||(l[16]=[i("div",{class:"placeholder-icon"},"🏭",-1),i("p",null,"請選擇左側供應商查看詳細資料",-1)])))])]),Ca.value||ja.value?(b(),t("div",{key:0,class:"modal-overlay",onClick:Pa},[i("div",{class:"modal-content",onClick:l[12]||(l[12]=r(()=>{},["stop"]))},[i("div",va,[i("h2",null,p(Ca.value?"新增供應商":"編輯供應商"),1),i("button",{onClick:Pa,class:"close-btn"},"✕")]),i("form",{onSubmit:r(Ea,["prevent"]),class:"supplier-form"},[i("div",ra,[l[30]||(l[30]=i("label",{for:"name"},"供應商名稱 *",-1)),c(i("input",{id:"name","onUpdate:modelValue":l[5]||(l[5]=a=>Va.value.name=a),type:"text",required:"",placeholder:"請輸入供應商名稱"},null,512),[[d,Va.value.name]])]),i("div",ma,[l[31]||(l[31]=i("label",{for:"email"},"電子郵件",-1)),c(i("input",{id:"email","onUpdate:modelValue":l[6]||(l[6]=a=>Va.value.email=a),type:"email",placeholder:"請輸入電子郵件"},null,512),[[d,Va.value.email]])]),i("div",ba,[l[32]||(l[32]=i("label",{for:"line_id"},"LINE ID",-1)),c(i("input",{id:"line_id","onUpdate:modelValue":l[7]||(l[7]=a=>Va.value.line_id=a),type:"text",placeholder:"請輸入 LINE ID"},null,512),[[d,Va.value.line_id]])]),i("div",_a,[l[33]||(l[33]=i("label",{for:"phone"},"聯絡電話",-1)),c(i("input",{id:"phone","onUpdate:modelValue":l[8]||(l[8]=a=>Va.value.phone=a),type:"tel",placeholder:"請輸入聯絡電話"},null,512),[[d,Va.value.phone]])]),i("div",ka,[l[34]||(l[34]=i("label",{for:"bank_name"},"銀行名稱",-1)),c(i("input",{id:"bank_name","onUpdate:modelValue":l[9]||(l[9]=a=>Va.value.bank_name=a),type:"text",placeholder:"請輸入銀行名稱"},null,512),[[d,Va.value.bank_name]])]),i("div",ha,[l[35]||(l[35]=i("label",{for:"bank_account"},"銀行帳號",-1)),c(i("input",{id:"bank_account","onUpdate:modelValue":l[10]||(l[10]=a=>Va.value.bank_account=a),type:"text",placeholder:"請輸入銀行帳號"},null,512),[[d,Va.value.bank_account]])]),i("div",ya,[l[36]||(l[36]=i("label",{for:"bank_code"},"銀行代碼",-1)),c(i("input",{id:"bank_code","onUpdate:modelValue":l[11]||(l[11]=a=>Va.value.bank_code=a),type:"text",placeholder:"請輸入銀行代碼"},null,512),[[d,Va.value.bank_code]])]),i("div",fa,[i("button",{type:"button",onClick:Pa,class:"cancel-btn"},"取消"),i("button",{type:"submit",class:"save-btn",disabled:!Va.value.name},"儲存",8,ga)])],32)])])):s("",!0)]))}}),[["__scopeId","data-v-58b3eb72"]]);export{wa as default};
