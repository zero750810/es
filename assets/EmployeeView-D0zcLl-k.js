import{a as l,r as a,c as e,j as t,e as u,f as n,i as s,z as o,A as i,C as r,F as d,g as v,t as p,y as c,n as m,o as b}from"./vue-Cvy1YwU9.js";import{b as y,_ as f}from"./index-DNTCz2Zq.js";import"./vendor-C7jwa7K6.js";const h={class:"employee"},g={class:"page-header"},k={class:"filters"},w={key:0,class:"loading"},C={key:1,class:"empty-state"},V={key:2,class:"employee-table"},_={class:"employee-name"},U={class:"salary"},j={class:"actions"},q=["onClick"],x=["onClick"],A={class:"modal-header"},I={class:"form-group"},L={class:"form-group"},N=["disabled"],S={key:0,class:"form-group"},P={class:"form-group"},z={class:"form-group"},D={class:"modal-actions"},T=["disabled"],E=f(l({__name:"EmployeeView",setup(l){const f=y(),E=a([]),F=a(!1),W=a(""),$=a(""),B=a(!1),G=a(!1),H=a(!1),J=a(null),K=a({name:"",email:"",password:"",role:"",pay:0}),M=e(()=>{let l=E.value;return W.value&&(l=l.filter(l=>l.name.toLowerCase().includes(W.value.toLowerCase()))),$.value&&(l=l.filter(l=>l.role===Number($.value))),l.sort((l,a)=>l.name.localeCompare(a.name))}),O=l=>({0:"一般員工",1:"主管",2:"管理員"}[l]||"未知角色"),Q=()=>{B.value=!1,G.value=!1,K.value={name:"",email:"",password:"",role:"",pay:0},J.value=null},R=async()=>{H.value=!0;try{if(B.value){const l={name:K.value.name,mail:K.value.email,role:Number(K.value.role),pay:K.value.pay,deleted_at:null};await f.callAPI({table:"staff",action:"create",data:l})}else J.value&&await f.callAPI({table:"staff",action:"update",data:{id:J.value.id,name:K.value.name,role:Number(K.value.role),pay:K.value.pay}});await X(),Q()}catch(l){}finally{H.value=!1}},X=async()=>{F.value=!0;try{const l=await f.callAPI({table:"staff",action:"read"});l&&(E.value=l.filter(l=>!l.deleted_at))}catch(l){}finally{F.value=!1}};return t(X),(l,a)=>(b(),u("div",h,[n("div",g,[a[9]||(a[9]=n("h1",null,"員工管理",-1)),n("button",{onClick:a[0]||(a[0]=l=>B.value=!0),class:"btn btn-primary"}," 新增員工 ")]),n("div",k,[o(n("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>W.value=l),type:"text",placeholder:"搜尋員工姓名...",class:"search-input"},null,512),[[i,W.value]]),o(n("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>$.value=l),class:"filter-select"},a[10]||(a[10]=[n("option",{value:""},"所有角色",-1),n("option",{value:"0"},"一般員工",-1),n("option",{value:"1"},"主管",-1),n("option",{value:"2"},"管理員",-1)]),512),[[r,$.value]])]),F.value?(b(),u("div",w,"載入中...")):0===M.value.length?(b(),u("div",C,a[11]||(a[11]=[n("div",{class:"empty-icon"},"👥",-1),n("p",null,"尚無員工資料",-1)]))):(b(),u("div",V,[n("table",null,[a[13]||(a[13]=n("thead",null,[n("tr",null,[n("th",null,"姓名"),n("th",null,"角色"),n("th",null,"薪資"),n("th",null,"加入日期"),n("th",null,"狀態"),n("th",null,"操作")])],-1)),n("tbody",null,[(b(!0),u(d,null,v(M.value,l=>{return b(),u("tr",{key:l.id},[n("td",_,p(l.name),1),n("td",null,[n("span",{class:m(["role-badge",(t=l.role,{0:"role-employee",1:"role-manager",2:"role-admin"}[t]||"")])},p(O(l.role)),3)]),n("td",U,"NT$ "+p(l.pay?l.pay.toLocaleString():"0"),1),n("td",null,p((e=l.created_at,new Date(e).toLocaleDateString("zh-TW"))),1),a[12]||(a[12]=n("td",null,[n("span",{class:"status-badge status-active"},"在職")],-1)),n("td",j,[n("button",{onClick:a=>(l=>{J.value=l,K.value={name:l.name,email:l.mail,password:"",role:l.role.toString(),pay:l.pay},G.value=!0})(l),class:"btn btn-sm btn-outline"}," 編輯 ",8,q),n("button",{onClick:l=>{},class:"btn btn-sm btn-primary"}," 詳情 ",8,x)])]);var e,t}),128))])])])),B.value||G.value?(b(),u("div",{key:3,class:"modal-overlay",onClick:Q},[n("div",{class:"modal",onClick:a[8]||(a[8]=c(()=>{},["stop"]))},[n("div",A,[n("h2",null,p(B.value?"新增員工":"編輯員工"),1),n("button",{onClick:Q,class:"close-btn"},"×")]),n("form",{onSubmit:c(R,["prevent"]),class:"modal-body"},[n("div",I,[a[14]||(a[14]=n("label",null,"姓名 *",-1)),o(n("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>K.value.name=l),type:"text",required:""},null,512),[[i,K.value.name]])]),n("div",L,[a[15]||(a[15]=n("label",null,"電子郵件 *",-1)),o(n("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>K.value.email=l),type:"email",required:"",disabled:G.value},null,8,N),[[i,K.value.email]])]),B.value?(b(),u("div",S,[a[16]||(a[16]=n("label",null,"初始密碼 *",-1)),o(n("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>K.value.password=l),type:"password",required:""},null,512),[[i,K.value.password]])])):s("",!0),n("div",P,[a[18]||(a[18]=n("label",null,"角色 *",-1)),o(n("select",{"onUpdate:modelValue":a[6]||(a[6]=l=>K.value.role=l),required:""},a[17]||(a[17]=[n("option",{value:""},"請選擇角色",-1),n("option",{value:"0"},"一般員工",-1),n("option",{value:"1"},"主管",-1),n("option",{value:"2"},"管理員",-1)]),512),[[r,K.value.role]])]),n("div",z,[a[19]||(a[19]=n("label",null,"薪資",-1)),o(n("input",{"onUpdate:modelValue":a[7]||(a[7]=l=>K.value.pay=l),type:"number",min:"0"},null,512),[[i,K.value.pay,void 0,{number:!0}]])]),n("div",D,[n("button",{type:"button",onClick:Q,class:"btn btn-outline"}," 取消 "),n("button",{type:"submit",class:"btn btn-primary",disabled:H.value},p(H.value?"處理中...":B.value?"新增":"更新"),9,T)])],32)])])):s("",!0)]))}}),[["__scopeId","data-v-bf11a415"]]);export{E as default};
