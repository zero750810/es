import{a,v as e,c as s,r as t,j as c,e as l,f as i,t as n,l as d,n as r,i as o,F as v,g as u,x as p,o as m}from"./vue-CVAoqndi.js";import{u as y,a as h,b as g,_ as b}from"./index-DxdkvUcA.js";import"./vendor-C7jwa7K6.js";const f={class:"dashboard"},k={class:"dashboard-header"},_={class:"welcome-text"},j={class:"stats-overview"},C={class:"stat-card"},S={class:"stat-content"},w={class:"stat-number"},x={class:"stat-card"},L={class:"stat-content"},$={class:"stat-number"},D={class:"stat-card"},R={class:"stat-content"},T={class:"stat-number"},q={class:"main-dashboard-grid"},P={class:"dashboard-card-compact reminders-card"},N={class:"card-header-compact"},z=["disabled"],A={class:"card-content-compact"},E={key:0,class:"loading-state-compact"},W={key:1,class:"empty-state-compact"},F={key:2,class:"reminders-compact"},I=["onClick"],M={class:"reminder-date"},V={class:"reminder-content"},B={class:"reminder-type"},G={class:"reminder-text"},H={key:0,class:"view-more-compact"},J={class:"dashboard-card-compact business-summary"},K={class:"card-header-compact"},O={class:"summary-date"},Q={class:"card-content-compact"},U={class:"summary-section"},X={class:"section-header"},Y={class:"section-count"},Z={key:0,class:"section-empty"},aa={key:1,class:"projects-compact"},ea=["onClick"],sa={class:"project-info"},ta={class:"project-name"},ca={class:"project-client"},la={class:"project-amount"},ia={key:0,class:"more-projects"},na={class:"summary-section"},da={class:"section-header"},ra={class:"section-count"},oa={key:0,class:"section-empty"},va={key:1,class:"payments-compact"},ua={class:"payments-summary"},pa={class:"payment-stat receivable"},ma={class:"payment-count"},ya={class:"payment-stat payable"},ha={class:"payment-count"},ga={class:"recent-payments"},ba=["onClick"],fa={class:"payment-desc"},ka={key:1,class:"expanded-payments"},_a=["onClick"],ja={class:"payment-desc"},Ca=b(a({__name:"DashboardView",setup(a){const b=p(),Ca=y(),Sa=h(),wa=g(),{user:xa}=e(Ca),{reminders:La,crmList:$a,projectList:Da,paymentRequests:Ra,accountPayable:Ta}=e(Sa),qa=s(()=>wa.loading.value),Pa=t(!1),Na=s(()=>{var a;return(null==(a=xa.value)?void 0:a.id)&&Da.value?Da.value.filter(a=>{var e,s;return(null==(e=a.executor_id)?void 0:e.toString())===(null==(s=xa.value.id)?void 0:s.toString())&&!a.deleted_at&&4!==a.state}):[]}),za=s(()=>{var a;const e=[];return(null==(a=xa.value)?void 0:a.id)?(Ra.value&&Ra.value.forEach(a=>{a.executor_id!==xa.value.id||a.final||e.push({id:`receivable-${a.id}`,type:"receivable",amount:a.amount||0,description:`客戶：${Aa(a.crm_id)}`,data:a})}),Ta.value&&Ta.value.forEach(a=>{a.executor_id!==xa.value.id||a.final||e.push({id:`payable-${a.id}`,type:"payable",amount:a.amount||0,description:a.description||"應付款項",data:a})}),e.slice(0,10)):e}),Aa=a=>{var e;if(!a)return"未指定";const s=null==(e=$a.value)?void 0:e.find(e=>e.id.toString()===a.toString());return(null==s?void 0:s.name)||"未指定"},Ea=a=>{b.push("/accounting")},Wa=async()=>{await Sa.refreshReminders()},Fa=()=>{Pa.value=!Pa.value},Ia=a=>new Date(a.reminder_date||a.created_at).toLocaleDateString("zh-TW",{month:"short",day:"numeric"}),Ma=a=>za.value.filter(e=>e.type===a).length,Va=a=>{var e;if(a.crm_id){return`客戶：${Aa(a.crm_id)}`}if(a.project_id){const s=null==(e=Da.value)?void 0:e.find(e=>e.id.toString()===a.project_id.toString());return`專案：${(null==s?void 0:s.project_name)||"未知專案"}`}return"系統提醒"};return c(async()=>{await Promise.all([Sa.refreshReminders(),Sa.fetchCRMList(),Sa.fetchProjectList(),Sa.fetchAccountReceivable(),Sa.fetchAccountPayable()])}),(a,e)=>{var s,t;return m(),l("div",f,[i("div",k,[i("p",_,"歡迎回來，"+n(null==(s=d(xa))?void 0:s.name)+" / "+n(null==(t=d(xa))?void 0:t.mail),1)]),i("div",j,[i("div",C,[e[1]||(e[1]=i("div",{class:"stat-icon"},"📝",-1)),i("div",S,[i("div",w,n(d(La).length),1),e[0]||(e[0]=i("div",{class:"stat-label"},"待辦提醒",-1))])]),i("div",x,[e[3]||(e[3]=i("div",{class:"stat-icon"},"📋",-1)),i("div",L,[i("div",$,n(Na.value.length),1),e[2]||(e[2]=i("div",{class:"stat-label"},"負責專案",-1))])]),i("div",D,[e[5]||(e[5]=i("div",{class:"stat-icon"},"💰",-1)),i("div",R,[i("div",T,n(za.value.length),1),e[4]||(e[4]=i("div",{class:"stat-label"},"待處理款項",-1))])])]),i("div",q,[i("div",P,[i("div",N,[e[6]||(e[6]=i("h3",null,"📝 待辦提醒",-1)),i("button",{onClick:Wa,class:"refresh-btn-compact",disabled:qa.value},[i("span",{class:r(["refresh-icon",{spinning:qa.value}])},"🔄",2)],8,z)]),i("div",A,[qa.value?(m(),l("div",E,"載入中...")):0===d(La).length?(m(),l("div",W,e[7]||(e[7]=[i("p",null,"目前沒有待辦事項",-1)]))):(m(),l("div",F,[(m(!0),l(v,null,u(d(La).slice(0,6),a=>(m(),l("div",{key:a.id,class:"reminder-item-compact",onClick:e=>(a=>{a.crm_id?b.push({path:"/crm",query:{client:a.crm_id}}):a.project_id&&b.push({path:"/project",query:{id:a.project_id}})})(a)},[i("div",M,n(Ia(a)),1),i("div",V,[i("div",B,n(Va(a)),1),i("div",G,n(a.note),1)])],8,I))),128)),d(La).length>6?(m(),l("div",H," 還有 "+n(d(La).length-6)+" 個提醒... ",1)):o("",!0)]))])]),i("div",J,[i("div",K,[e[8]||(e[8]=i("h3",null,"🎯 業務摘要",-1)),i("span",O,n((new Date).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})),1)]),i("div",Q,[i("div",U,[i("div",X,[e[9]||(e[9]=i("span",{class:"section-title"},"📋 負責專案",-1)),i("span",Y,n(Na.value.length),1)]),0===Na.value.length?(m(),l("div",Z," 目前沒有負責的專案 ")):(m(),l("div",aa,[(m(!0),l(v,null,u(Na.value.slice(0,3),a=>(m(),l("div",{key:a.id,class:"project-row",onClick:e=>(a=>{b.push({path:"/project",query:{id:a.id}})})(a)},[i("div",sa,[i("span",ta,n(a.project_name),1),i("span",ca,n(Aa(a.crm_id)),1)]),i("div",la," NT$ "+n(a.receivable.toLocaleString()),1)],8,ea))),128)),Na.value.length>3?(m(),l("div",ia," 還有 "+n(Na.value.length-3)+" 個專案 ",1)):o("",!0)]))]),i("div",na,[i("div",da,[e[10]||(e[10]=i("span",{class:"section-title"},"💰 待處理款項",-1)),i("span",ra,n(za.value.length),1)]),0===za.value.length?(m(),l("div",oa," 目前沒有待處理款項 ")):(m(),l("div",va,[i("div",ua,[i("div",pa,[e[11]||(e[11]=i("span",{class:"payment-type"},"應收",-1)),i("span",ma,n(Ma("receivable")),1)]),i("div",ya,[e[12]||(e[12]=i("span",{class:"payment-type"},"應付",-1)),i("span",ha,n(Ma("payable")),1)])]),i("div",ga,[(m(!0),l(v,null,u(za.value.slice(0,2),a=>(m(),l("div",{key:a.id,class:"payment-item",onClick:a=>Ea()},[i("span",fa,n(a.description),1),i("span",{class:r(["payment-amount",a.type])}," NT$ "+n(a.amount.toLocaleString()),3)],8,ba))),128))]),za.value.length>2?(m(),l("div",{key:0,class:"more-payments",onClick:Fa},n(Pa.value?"收起":`還有 ${za.value.length-2} 筆款項,點下展開`),1)):o("",!0),Pa.value?(m(),l("div",ka,[(m(!0),l(v,null,u(za.value.slice(2),a=>(m(),l("div",{key:a.id,class:"payment-item",onClick:a=>Ea()},[i("span",ja,n(a.description),1),i("span",{class:r(["payment-amount",a.type])}," NT$ "+n(a.amount.toLocaleString()),3)],8,_a))),128))])):o("",!0)]))])])])])])}}}),[["__scopeId","data-v-920df922"]]);export{Ca as default};
