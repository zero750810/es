import{a,r as l,c as e,j as t,e as n,f as i,i as s,z as c,A as o,F as d,g as u,t as v,E as p,y as r,n as m,x as b,o as h}from"./vue-CVAoqndi.js";import{a as _,b as k,_ as y}from"./index-DxdkvUcA.js";import"./vendor-C7jwa7K6.js";const f={class:"supplier-view"},g={class:"page-header"},C={class:"supplier-layout"},w={class:"supplier-sidebar"},A={class:"search-section"},I={key:0,class:"loading-state"},j={key:1,class:"empty-state"},V={key:2,class:"supplier-list-compact"},U=["onClick"],x={class:"supplier-header"},L={class:"supplier-category"},P={class:"supplier-meta"},D={class:"supplier-phone"},S={class:"supplier-email"},E={class:"supplier-detail"},N={key:0,class:"detail-placeholder"},q={key:1,class:"detail-content"},z={class:"detail-section"},T={class:"section-header"},$={class:"section-actions"},F={class:"info-display-compact"},W={class:"info-grid-pairs"},B={class:"info-pair"},G={class:"info-item-compact"},H={class:"info-item-compact"},J={class:"info-pair"},K={class:"info-item-compact"},M={class:"info-item-compact"},O={class:"info-pair"},Q={class:"info-item-compact"},R={class:"bank-info-compact"},X={class:"bank-grid"},Y={class:"bank-item"},Z={class:"bank-item"},aa={class:"bank-item"},la={class:"detail-section"},ea={class:"section-header"},ta={class:"section-actions"},na={key:0,class:"empty-state"},ia={key:1,class:"contacts-table-compact"},sa={class:"contact-table-body"},ca={class:"td-name"},oa={class:"contact-name"},da={key:0,class:"contact-note"},ua={class:"td-position"},va={class:"td-phone"},pa={class:"td-email"},ra={class:"td-actions"},ma=["onClick"],ba=["onClick"],ha={class:"detail-section"},_a={class:"section-header"},ka={class:"count-badge"},ya={key:0,class:"empty-state"},fa={key:1,class:"projects-table-compact"},ga=["onClick"],Ca={class:"td-project"},wa={class:"td-client"},Aa={class:"td-amount"},Ia={class:"td-date"},ja={class:"td-action"},Va=["onClick"],Ua={class:"modal-header"},xa={class:"form-group"},La={class:"form-group"},Pa={class:"form-group"},Da={class:"form-group"},Sa={class:"form-group"},Ea={class:"form-group"},Na={class:"form-group"},qa={class:"form-actions"},za=["disabled"],Ta={class:"modal-header"},$a={class:"form-group"},Fa={class:"form-group"},Wa={class:"form-group"},Ba={class:"form-group"},Ga={class:"form-group"},Ha={class:"form-actions"},Ja=["disabled"],Ka=y(a({__name:"SupplierView",setup(a){const y=b(),Ka=_(),Ma=k(),Oa=l(!1),Qa=l(!1),Ra=l(null),Xa=l(null),Ya=l(""),Za=l(!1),al=l(!1),ll=l(null),el=l([]),tl=l({name:"",position:"",phone:"",mail:"",note:""}),nl=l({name:"",line_id:"",email:"",phone:"",bank_name:"",bank_account:"",bank_code:"",tag_type:[]}),il=e(()=>Ka.supplier||[]),sl=e(()=>Ma.loading.value),cl=e(()=>Ya.value?il.value.filter(a=>a.name.toLowerCase().includes(Ya.value.toLowerCase())):il.value),ol=l([]),dl=e(()=>Xa.value?el.value.filter(a=>a.supplier_id===Xa.value.id):[]),ul=e(()=>{if(!Xa.value)return[];const a=ol.value.filter(a=>{var l;return a.supplier_id===(null==(l=Xa.value)?void 0:l.id)&&!a.deleted_at}),l=Ka.projectList||[],e=[...new Set(a.map(a=>a.project_id))];return l.filter(a=>e.includes(a.id)&&!a.deleted_at).map(l=>{const e=a.filter(a=>a.project_id===l.id).reduce((a,l)=>a+(l.pay||0),0);return{...l,supplierAmount:e}})}),vl=()=>{Oa.value=!1,Qa.value=!1,Ra.value=null,nl.value={name:"",line_id:"",email:"",phone:"",bank_name:"",bank_account:"",bank_code:"",tag_type:[]}},pl=async()=>{try{Oa.value?await Ma.callAPI({table:"supplier",action:"create",data:nl.value}):Ra.value&&await Ma.callAPI({table:"supplier",action:"update",data:{id:Ra.value.id,...nl.value}}),await Ka.refreshData(),vl()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},rl=()=>{Za.value=!1,al.value=!1,ll.value=null,tl.value={name:"",position:"",phone:"",mail:"",note:""}},ml=async()=>{if(Xa.value)try{const a={...tl.value,supplier_id:Xa.value.id};Za.value?await Ma.callAPI({table:"contact_person",action:"create",data:a}):ll.value&&await Ma.callAPI({table:"contact_person",action:"update",data:{id:ll.value.id,...a}}),await yl(),rl()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},bl=a=>{if(!a.tag_type||0===a.tag_type.length)return"æœªåˆ†é¡";return(Ka.tags||[]).filter(l=>a.tag_type.includes(l.id)&&"supplier"===l.type).map(a=>a.name).join(", ")||"æœªåˆ†é¡"},hl=a=>{if(!a)return"æœªæŒ‡å®šå®¢æˆ¶";const l=Ka.crmList.find(l=>l.id.toString()===a.toString());return(null==l?void 0:l.name)||"æœªçŸ¥å®¢æˆ¶"},_l=a=>{y.push(`/project?id=${a.id}`)},kl=async()=>{try{const a=await Ma.callAPI({table:"project_detail",action:"read"});a&&Array.isArray(a)&&(ol.value=a)}catch(a){}},yl=async()=>{try{const a=await Ma.callAPI({table:"contact_person",action:"read"});a&&Array.isArray(a)&&(el.value=a)}catch(a){}};return t(async()=>{await Promise.all([Ka.refreshData(),kl(),yl()])}),(a,l)=>(h(),n("div",f,[i("div",g,[l[20]||(l[20]=i("h1",null,"ä¾›æ‡‰å•†ç®¡ç†",-1)),i("button",{onClick:l[0]||(l[0]=a=>Oa.value=!0),class:"add-btn"}," â• æ–°å¢ä¾›æ‡‰å•† ")]),i("div",C,[i("div",w,[i("div",A,[c(i("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>Ya.value=a),type:"text",placeholder:"æœå°‹ä¾›æ‡‰å•†åç¨±...",class:"search-input"},null,512),[[o,Ya.value]])]),sl.value?(h(),n("div",I," è¼‰å…¥ä¸­... ")):0===cl.value.length?(h(),n("div",j,[l[21]||(l[21]=i("div",{class:"empty-icon"},"ğŸ­",-1)),l[22]||(l[22]=i("p",null,"å°šæœªæ–°å¢ä»»ä½•ä¾›æ‡‰å•†",-1)),i("button",{onClick:l[2]||(l[2]=a=>Oa.value=!0),class:"add-btn-small"},"æ–°å¢ç¬¬ä¸€å€‹ä¾›æ‡‰å•†")])):(h(),n("div",V,[(h(!0),n(d,null,u(cl.value,a=>{var l;return h(),n("div",{key:a.id,class:m(["supplier-item-compact",{active:(null==(l=Xa.value)?void 0:l.id)===a.id}]),onClick:l=>(a=>{Xa.value=a})(a)},[i("div",x,[i("h4",null,v(a.name),1),i("span",L,v(bl(a)),1)]),i("div",P,[i("span",D,v(a.phone||"æœªè¨­å®šé›»è©±"),1),i("span",S,v(a.email||"æœªè¨­å®šä¿¡ç®±"),1)])],10,U)}),128))]))]),i("div",E,[Xa.value?(h(),n("div",q,[i("div",z,[i("div",T,[l[24]||(l[24]=i("h3",null,"åŸºæœ¬è³‡è¨Š",-1)),i("div",$,[i("button",{onClick:l[3]||(l[3]=a=>{return l=Xa.value,Ra.value=l,nl.value={name:l.name||"",line_id:l.line_id||"",email:l.email||"",phone:l.phone||"",bank_name:l.bank_name||"",bank_account:l.bank_account||"",bank_code:l.bank_code||"",tag_type:l.tag_type||[]},void(Qa.value=!0);var l}),class:"btn-edit"},"ç·¨è¼¯"),i("button",{onClick:l[4]||(l[4]=a=>(async a=>{var l;if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ä¾›æ‡‰å•†å—ï¼Ÿ"))try{await Ma.callAPI({table:"supplier",action:"delete",data:{id:a}}),(null==(l=Xa.value)?void 0:l.id)===a&&(Xa.value=null),await Ka.refreshData()}catch(e){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(Xa.value.id)),class:"btn-delete"},"åˆªé™¤")])]),i("div",F,[i("div",W,[i("div",B,[i("div",G,[l[25]||(l[25]=i("label",null,"ä¾›æ‡‰å•†åç¨±",-1)),i("span",null,v(Xa.value.name),1)]),i("div",H,[l[26]||(l[26]=i("label",null,"ä¾›æ‡‰å•†åˆ†é¡",-1)),i("span",null,v(bl(Xa.value)),1)])]),i("div",J,[i("div",K,[l[27]||(l[27]=i("label",null,"è¯çµ¡é›»è©±",-1)),i("span",null,v(Xa.value.phone||"æœªè¨­å®š"),1)]),i("div",M,[l[28]||(l[28]=i("label",null,"é›»å­éƒµä»¶",-1)),i("span",null,v(Xa.value.email||"æœªè¨­å®š"),1)])]),i("div",O,[i("div",Q,[l[29]||(l[29]=i("label",null,"LINE ID",-1)),i("span",null,v(Xa.value.line_id||"æœªè¨­å®š"),1)])])]),i("div",R,[l[33]||(l[33]=i("h5",null,"éŠ€è¡Œè³‡è¨Š",-1)),i("div",X,[i("div",Y,[l[30]||(l[30]=i("label",null,"éŠ€è¡Œåç¨±",-1)),i("span",null,v(Xa.value.bank_name||"æœªè¨­å®š"),1)]),i("div",Z,[l[31]||(l[31]=i("label",null,"éŠ€è¡Œå¸³è™Ÿ",-1)),i("span",null,v(Xa.value.bank_account||"æœªè¨­å®š"),1)]),i("div",aa,[l[32]||(l[32]=i("label",null,"éŠ€è¡Œä»£ç¢¼",-1)),i("span",null,v(Xa.value.bank_code||"æœªè¨­å®š"),1)])])])])]),i("div",la,[i("div",ea,[l[34]||(l[34]=i("h3",null,"è¯çµ¡äººè³‡è¨Š",-1)),i("div",ta,[i("button",{onClick:l[5]||(l[5]=a=>Za.value=!0),class:"btn-edit"},"æ–°å¢è¯çµ¡äºº")])]),0===dl.value.length?(h(),n("div",na,l[35]||(l[35]=[i("p",null,"å°šæœªæ–°å¢ä»»ä½•è¯çµ¡äºº",-1)]))):(h(),n("div",ia,[l[36]||(l[36]=p('<div class="contact-table-header" data-v-0ec70260><div class="th-name" data-v-0ec70260>å§“å</div><div class="th-position" data-v-0ec70260>è·å‹™</div><div class="th-phone" data-v-0ec70260>é›»è©±</div><div class="th-email" data-v-0ec70260>ä¿¡ç®±</div><div class="th-actions" data-v-0ec70260>æ“ä½œ</div></div>',1)),i("div",sa,[(h(!0),n(d,null,u(dl.value,a=>(h(),n("div",{key:a.id,class:"contact-row"},[i("div",ca,[i("div",oa,v(a.name),1),a.note?(h(),n("div",da,v(a.note),1)):s("",!0)]),i("div",ua,v(a.position||"-"),1),i("div",va,v(a.phone||"-"),1),i("div",pa,v(a.mail||"-"),1),i("div",ra,[i("button",{onClick:l=>(a=>{ll.value=a,tl.value={name:a.name||"",position:a.position||"",phone:a.phone||"",mail:a.mail||"",note:a.note||""},al.value=!0})(a),class:"btn-action btn-edit",title:"ç·¨è¼¯"},"âœï¸",8,ma),i("button",{onClick:l=>(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è¯çµ¡äººå—ï¼Ÿ"))try{await Ma.callAPI({table:"contact_person",action:"delete",data:{id:a}}),await yl()}catch(l){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-action btn-delete",title:"åˆªé™¤"},"ğŸ—‘ï¸",8,ba)])]))),128))])]))]),i("div",ha,[i("div",_a,[l[37]||(l[37]=i("h3",null,"ç›¸é—œå°ˆæ¡ˆ",-1)),i("span",ka,v(ul.value.length),1)]),0===ul.value.length?(h(),n("div",ya,l[38]||(l[38]=[i("p",null,"æ­¤ä¾›æ‡‰å•†å°šæœªåƒèˆ‡ä»»ä½•å°ˆæ¡ˆ",-1)]))):(h(),n("div",fa,[l[39]||(l[39]=p('<div class="table-header-compact" data-v-0ec70260><div class="th-project" data-v-0ec70260>å°ˆæ¡ˆåç¨±</div><div class="th-client" data-v-0ec70260>å®¢æˆ¶</div><div class="th-amount" data-v-0ec70260>åˆä½œé‡‘é¡</div><div class="th-date" data-v-0ec70260>å»ºç«‹æ—¥æœŸ</div><div class="th-action" data-v-0ec70260>æ“ä½œ</div></div>',1)),(h(!0),n(d,null,u(ul.value,a=>{var l,e;return h(),n("div",{key:a.id,class:"table-row-compact",onClick:l=>_l(a)},[i("div",Ca,v(a.project_name),1),i("div",wa,v(hl(a.crm_id)),1),i("div",Aa,"NT$ "+v((null==(l=a.supplierAmount)?void 0:l.toLocaleString())||"0"),1),i("div",Ia,v((e=a.created_at,new Date(e).toLocaleDateString("zh-TW"))),1),i("div",ja,[i("button",{class:"btn-icon-compact",onClick:r(l=>_l(a),["stop"])},"ğŸ”—",8,Va)])],8,ga)}),128))]))])])):(h(),n("div",N,l[23]||(l[23]=[i("div",{class:"placeholder-icon"},"ğŸ­",-1),i("p",null,"è«‹é¸æ“‡å·¦å´ä¾›æ‡‰å•†æŸ¥çœ‹è©³ç´°è³‡æ–™",-1)])))])]),Oa.value||Qa.value?(h(),n("div",{key:0,class:"modal-overlay",onClick:vl},[i("div",{class:"modal-content",onClick:l[13]||(l[13]=r(()=>{},["stop"]))},[i("div",Ua,[i("h2",null,v(Oa.value?"æ–°å¢ä¾›æ‡‰å•†":"ç·¨è¼¯ä¾›æ‡‰å•†"),1),i("button",{onClick:vl,class:"close-btn"},"âœ•")]),i("form",{onSubmit:r(pl,["prevent"]),class:"supplier-form"},[i("div",xa,[l[40]||(l[40]=i("label",{for:"name"},"ä¾›æ‡‰å•†åç¨± *",-1)),c(i("input",{id:"name","onUpdate:modelValue":l[6]||(l[6]=a=>nl.value.name=a),type:"text",required:"",placeholder:"è«‹è¼¸å…¥ä¾›æ‡‰å•†åç¨±"},null,512),[[o,nl.value.name]])]),i("div",La,[l[41]||(l[41]=i("label",{for:"email"},"é›»å­éƒµä»¶",-1)),c(i("input",{id:"email","onUpdate:modelValue":l[7]||(l[7]=a=>nl.value.email=a),type:"email",placeholder:"è«‹è¼¸å…¥é›»å­éƒµä»¶"},null,512),[[o,nl.value.email]])]),i("div",Pa,[l[42]||(l[42]=i("label",{for:"line_id"},"LINE ID",-1)),c(i("input",{id:"line_id","onUpdate:modelValue":l[8]||(l[8]=a=>nl.value.line_id=a),type:"text",placeholder:"è«‹è¼¸å…¥ LINE ID"},null,512),[[o,nl.value.line_id]])]),i("div",Da,[l[43]||(l[43]=i("label",{for:"phone"},"è¯çµ¡é›»è©±",-1)),c(i("input",{id:"phone","onUpdate:modelValue":l[9]||(l[9]=a=>nl.value.phone=a),type:"tel",placeholder:"è«‹è¼¸å…¥è¯çµ¡é›»è©±"},null,512),[[o,nl.value.phone]])]),i("div",Sa,[l[44]||(l[44]=i("label",{for:"bank_name"},"éŠ€è¡Œåç¨±",-1)),c(i("input",{id:"bank_name","onUpdate:modelValue":l[10]||(l[10]=a=>nl.value.bank_name=a),type:"text",placeholder:"è«‹è¼¸å…¥éŠ€è¡Œåç¨±"},null,512),[[o,nl.value.bank_name]])]),i("div",Ea,[l[45]||(l[45]=i("label",{for:"bank_account"},"éŠ€è¡Œå¸³è™Ÿ",-1)),c(i("input",{id:"bank_account","onUpdate:modelValue":l[11]||(l[11]=a=>nl.value.bank_account=a),type:"text",placeholder:"è«‹è¼¸å…¥éŠ€è¡Œå¸³è™Ÿ"},null,512),[[o,nl.value.bank_account]])]),i("div",Na,[l[46]||(l[46]=i("label",{for:"bank_code"},"éŠ€è¡Œä»£ç¢¼",-1)),c(i("input",{id:"bank_code","onUpdate:modelValue":l[12]||(l[12]=a=>nl.value.bank_code=a),type:"text",placeholder:"è«‹è¼¸å…¥éŠ€è¡Œä»£ç¢¼"},null,512),[[o,nl.value.bank_code]])]),i("div",qa,[i("button",{type:"button",onClick:vl,class:"cancel-btn"},"å–æ¶ˆ"),i("button",{type:"submit",class:"save-btn",disabled:!nl.value.name},"å„²å­˜",8,za)])],32)])])):s("",!0),Za.value||al.value?(h(),n("div",{key:1,class:"modal-overlay",onClick:rl},[i("div",{class:"modal-content",onClick:l[19]||(l[19]=r(()=>{},["stop"]))},[i("div",Ta,[i("h2",null,v(Za.value?"æ–°å¢è¯çµ¡äºº":"ç·¨è¼¯è¯çµ¡äºº"),1),i("button",{onClick:rl,class:"close-btn"},"âœ•")]),i("form",{onSubmit:r(ml,["prevent"]),class:"supplier-form"},[i("div",$a,[l[47]||(l[47]=i("label",{for:"contact_name"},"å§“å *",-1)),c(i("input",{id:"contact_name","onUpdate:modelValue":l[14]||(l[14]=a=>tl.value.name=a),type:"text",required:"",placeholder:"è«‹è¼¸å…¥è¯çµ¡äººå§“å"},null,512),[[o,tl.value.name]])]),i("div",Fa,[l[48]||(l[48]=i("label",{for:"contact_position"},"è·å‹™",-1)),c(i("input",{id:"contact_position","onUpdate:modelValue":l[15]||(l[15]=a=>tl.value.position=a),type:"text",placeholder:"è«‹è¼¸å…¥è·å‹™"},null,512),[[o,tl.value.position]])]),i("div",Wa,[l[49]||(l[49]=i("label",{for:"contact_phone"},"è¯çµ¡é›»è©±",-1)),c(i("input",{id:"contact_phone","onUpdate:modelValue":l[16]||(l[16]=a=>tl.value.phone=a),type:"tel",placeholder:"è«‹è¼¸å…¥è¯çµ¡é›»è©±"},null,512),[[o,tl.value.phone]])]),i("div",Ba,[l[50]||(l[50]=i("label",{for:"contact_email"},"é›»å­éƒµä»¶",-1)),c(i("input",{id:"contact_email","onUpdate:modelValue":l[17]||(l[17]=a=>tl.value.mail=a),type:"email",placeholder:"è«‹è¼¸å…¥é›»å­éƒµä»¶"},null,512),[[o,tl.value.mail]])]),i("div",Ga,[l[51]||(l[51]=i("label",{for:"contact_note"},"å‚™è¨»",-1)),c(i("textarea",{id:"contact_note","onUpdate:modelValue":l[18]||(l[18]=a=>tl.value.note=a),rows:"3",placeholder:"è«‹è¼¸å…¥å‚™è¨»"},null,512),[[o,tl.value.note]])]),i("div",Ha,[i("button",{type:"button",onClick:rl,class:"cancel-btn"},"å–æ¶ˆ"),i("button",{type:"submit",class:"save-btn",disabled:!tl.value.name},"å„²å­˜",8,Ja)])],32)])])):s("",!0)]))}}),[["__scopeId","data-v-0ec70260"]]);export{Ka as default};
