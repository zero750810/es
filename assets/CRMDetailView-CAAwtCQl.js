import{a as l,r as a,j as s,e,f as n,t,F as c,g as i,u as d,i as r,n as o,o as u}from"./vue-Cvy1YwU9.js";import{b as v,_ as m}from"./index-CETVKyUk.js";import"./vendor-B4ZmVpUI.js";const p={key:0,class:"crm-detail"},b={class:"detail-header"},y={class:"detail-grid"},k={class:"info-card"},_={class:"info-row"},h={class:"info-row"},w={class:"info-row"},f={class:"info-row"},C={class:"contacts-card"},g={class:"card-header"},x={key:0,class:"empty-state"},j={key:1,class:"contacts-list"},q={class:"contact-info"},D=["onClick"],z={class:"records-card"},F={class:"card-header"},I={key:0,class:"empty-state"},L={key:1,class:"records-list"},M={class:"record-date"},R={class:"record-content"},S={key:0,class:"next-follow-up"},T={class:"reminders-card"},V={class:"card-header"},W={key:0,class:"empty-state"},$={key:1,class:"reminders-list"},A={class:"reminder-content"},B={class:"reminder-date"},E={class:"reminder-text"},G=["onClick"],H={key:1,class:"loading"},J=m(l({__name:"CRMDetailView",setup(l){const m=d(),J=v(),K=a(null),N=a([]),O=a([]),P=a([]),Q=a(!1),U=a(!1),X=a(!1),Y=l=>new Date(l).toLocaleDateString("zh-TW"),Z=()=>{};return s(async()=>{const l=m.params.id,a=await J.query("crm","*",{id:l});a&&a.length>0&&(K.value=a[0]);const s=await J.query("crm_contact_person","*",{crm_id:l});s&&(N.value=s);const e=await J.query("contact_record","*",{crm_id:l});e&&(O.value=e);const n=await J.query("reminder","*",{crm_id:l});n&&(P.value=n)}),(l,a)=>K.value?(u(),e("div",p,[n("div",b,[n("button",{onClick:a[0]||(a[0]=a=>l.$router.back()),class:"back-btn"}," ← 返回 "),n("h1",null,t(K.value.name),1),n("button",{onClick:Z,class:"btn btn-primary"}," 編輯客戶 ")]),n("div",y,[n("div",k,[a[8]||(a[8]=n("h3",null,"基本資訊",-1)),n("div",_,[a[4]||(a[4]=n("label",null,"客戶名稱：",-1)),n("span",null,t(K.value.name),1)]),n("div",h,[a[5]||(a[5]=n("label",null,"公司名稱：",-1)),n("span",null,t(K.value.company_id||"-"),1)]),n("div",w,[a[6]||(a[6]=n("label",null,"地址：",-1)),n("span",null,t(K.value.address||"-"),1)]),n("div",f,[a[7]||(a[7]=n("label",null,"負責業務：",-1)),n("span",null,t(K.value.sales||"-"),1)])]),n("div",C,[n("div",g,[a[9]||(a[9]=n("h3",null,"聯絡人",-1)),n("button",{onClick:a[1]||(a[1]=l=>Q.value=!0),class:"btn btn-sm btn-primary"}," 新增聯絡人 ")]),0===N.value.length?(u(),e("div",x,a[10]||(a[10]=[n("p",null,"尚無聯絡人資料",-1)]))):(u(),e("div",j,[(u(!0),e(c,null,i(N.value,l=>(u(),e("div",{key:l.id,class:"contact-item"},[n("div",q,[n("h4",null,t(l.name),1),n("p",null,t(l.position),1),n("p",null,t(l.phone)+" • "+t(l.email),1)]),n("button",{onClick:l=>{},class:"btn btn-sm btn-outline"}," 編輯 ",8,D)]))),128))]))]),n("div",z,[n("div",F,[a[11]||(a[11]=n("h3",null,"聯繫紀錄",-1)),n("button",{onClick:a[2]||(a[2]=l=>U.value=!0),class:"btn btn-sm btn-primary"}," 新增紀錄 ")]),0===O.value.length?(u(),e("div",I,a[12]||(a[12]=[n("p",null,"尚無聯繫紀錄",-1)]))):(u(),e("div",L,[(u(!0),e(c,null,i(O.value,l=>(u(),e("div",{key:l.id,class:"record-item"},[n("div",M,t(Y(l.contact_date)),1),n("div",R,t(l.content),1),l.next_follow_up?(u(),e("div",S," 下次追蹤："+t(Y(l.next_follow_up)),1)):r("",!0)]))),128))]))]),n("div",T,[n("div",V,[a[13]||(a[13]=n("h3",null,"提醒事項",-1)),n("button",{onClick:a[3]||(a[3]=l=>X.value=!0),class:"btn btn-sm btn-primary"}," 新增提醒 ")]),0===P.value.length?(u(),e("div",W,a[14]||(a[14]=[n("p",null,"尚無提醒事項",-1)]))):(u(),e("div",$,[(u(!0),e(c,null,i(P.value,l=>(u(),e("div",{key:l.id,class:o(["reminder-item",{completed:l.is_completed}])},[n("div",A,[n("div",B,t(Y(l.reminder_date)),1),n("div",E,t(l.content),1)]),l.is_completed?r("",!0):(u(),e("button",{key:0,onClick:a=>(async l=>{await J.update("reminder",l.id,{is_completed:!0}),l.is_completed=!0})(l),class:"btn btn-sm btn-success"}," 完成 ",8,G))],2))),128))]))])])])):(u(),e("div",H," 載入中... "))}}),[["__scopeId","data-v-45c1b663"]]);export{J as default};
