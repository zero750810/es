import{a,r as e,e as s,f as l,y as r,i as o,z as i,A as t,t as n,x as u,o as d}from"./vue-Cvy1YwU9.js";import{u as c,s as m,_ as p}from"./index-m2nXL6kR.js";import"./vendor-BV1FDJi5.js";const v={class:"login-container"},f={class:"login-card"},w={class:"form-group"},b=["disabled"],h={class:"form-group"},g=["disabled"],y={key:0,class:"error-message"},E=["disabled"],_=["disabled"],k=p(a({__name:"LoginView",setup(a){const p=u(),k=c(),q=e(!1),j=e(""),x=e({email:"",password:""}),V=async()=>{q.value=!0,j.value="";try{const{data:a,error:e}=await m.auth.signInWithPassword({email:x.value.email,password:x.value.password});if(e)throw e;if(!a.user||!a.session)throw new Error("登入失敗：未能取得使用者資料");const{data:s,error:l}=await m.from("staff").select("*").eq("mail",a.user.email).single();if(l||!s)throw new Error("無法載入使用者資料，請聯繫系統管理員");k.$patch({session:a.session,user:s}),p.push("/")}catch(a){j.value=a instanceof Error?a.message:"登入失敗，請檢查您的帳號密碼"}finally{q.value=!1}},I=async()=>{q.value=!0,j.value="";try{if(!x.value.email)throw new Error("請輸入電子郵件");const{data:a,error:e}=await m.from("staff").select("*").eq("mail",x.value.email).single();if(e||!a)throw new Error("測試模式：找不到此使用者");k.$patch({user:a,session:{access_token:"test-token-"+Date.now(),user:{id:"test-user-"+a.id,email:a.mail}}}),p.push("/")}catch(a){j.value=a instanceof Error?a.message:"測試模式登入失敗"}finally{q.value=!1}};return(a,e)=>(d(),s("div",v,[l("div",f,[e[4]||(e[4]=l("div",{class:"login-header"},[l("h1",null,"活動公司 ERP 系統"),l("p",null,"請登入您的帳號")],-1)),l("form",{onSubmit:r(V,["prevent"]),class:"login-form"},[l("div",w,[e[2]||(e[2]=l("label",{for:"email"},"電子郵件",-1)),i(l("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=a=>x.value.email=a),type:"email",required:"",disabled:q.value,placeholder:"請輸入您的電子郵件",autocomplete:"email"},null,8,b),[[t,x.value.email]])]),l("div",h,[e[3]||(e[3]=l("label",{for:"password"},"密碼",-1)),i(l("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>x.value.password=a),type:"password",required:"",disabled:q.value,placeholder:"請輸入您的密碼",autocomplete:"current-password"},null,8,g),[[t,x.value.password]])]),j.value?(d(),s("div",y,n(j.value),1)):o("",!0),l("button",{type:"submit",class:"login-btn",disabled:q.value},n(q.value?"登入中...":"登入"),9,E),l("button",{type:"button",onClick:I,class:"fallback-btn",disabled:q.value}," 測試模式登入 ",8,_)],32),e[5]||(e[5]=l("div",{class:"login-footer"},[l("p",null,"忘記密碼？請聯繫系統管理員")],-1))])]))}}),[["__scopeId","data-v-0fb8cd3c"]]);export{k as default};
