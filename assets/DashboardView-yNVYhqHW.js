import{a,s as e,c as s,r as t,l as c,f as l,g as i,t as n,k as d,n as r,j as o,F as v,h as u,b as p,o as m}from"./vue-B-cAkLc6.js";import{u as y,a as h,b as g,_ as b}from"./index-BVk54o67.js";import"./vendor-C7jwa7K6.js";const k={class:"dashboard"},f={class:"stats-overview"},_={class:"stat-card"},j={class:"stat-content"},C={class:"stat-number"},S={class:"stat-card"},L={class:"stat-content"},$={class:"stat-number"},w={class:"stat-card"},x={class:"stat-content"},D={class:"stat-number"},R={class:"main-dashboard-grid"},T={class:"dashboard-card-compact reminders-card"},q={class:"card-header-compact"},P=["disabled"],N={class:"card-content-compact"},z={key:0,class:"loading-state-compact"},A={key:1,class:"empty-state-compact"},E={key:2,class:"reminders-compact"},W=["onClick"],F={class:"reminder-date"},I={class:"reminder-content"},M={class:"reminder-type"},V={class:"reminder-text"},B={key:0,class:"view-more-compact"},G={class:"dashboard-card-compact business-summary"},H={class:"card-header-compact"},J={class:"summary-date"},K={class:"card-content-compact"},O={class:"summary-section"},Q={class:"section-header"},U={class:"section-count"},X={key:0,class:"section-empty"},Y={key:1,class:"projects-compact"},Z=["onClick"],aa={class:"project-info"},ea={class:"project-name"},sa={class:"project-client"},ta={class:"project-amount"},ca={key:0,class:"more-projects"},la={class:"summary-section"},ia={class:"section-header"},na={class:"section-count"},da={key:0,class:"section-empty"},ra={key:1,class:"payments-compact"},oa={class:"payments-summary"},va={class:"payment-stat receivable"},ua={class:"payment-count"},pa={class:"payment-stat payable"},ma={class:"payment-count"},ya={class:"recent-payments"},ha=["onClick"],ga={class:"payment-desc"},ba={key:1,class:"expanded-payments"},ka=["onClick"],fa={class:"payment-desc"},_a=b(a({__name:"DashboardView",setup(a){const b=p(),_a=y(),ja=h(),Ca=g(),{user:Sa}=e(_a),{reminders:La,crmList:$a,projectList:wa,paymentRequests:xa,accountPayable:Da}=e(ja),Ra=s(()=>Ca.loading.value),Ta=t(!1),qa=s(()=>{var a;return(null==(a=Sa.value)?void 0:a.id)&&wa.value?wa.value.filter(a=>{var e,s;return(null==(e=a.executor_id)?void 0:e.toString())===(null==(s=Sa.value.id)?void 0:s.toString())&&!a.deleted_at&&4!==a.state}):[]}),Pa=s(()=>{var a;const e=[];return(null==(a=Sa.value)?void 0:a.id)?(xa.value&&xa.value.forEach(a=>{a.executor_id!==Sa.value.id||a.final||e.push({id:`receivable-${a.id}`,type:"receivable",amount:a.amount||0,description:`客戶：${Na(a.crm_id)}`,data:a})}),Da.value&&Da.value.forEach(a=>{a.executor_id!==Sa.value.id||a.final||e.push({id:`payable-${a.id}`,type:"payable",amount:a.amount||0,description:a.description||"應付款項",data:a})}),e.slice(0,10)):e}),Na=a=>{var e;if(!a)return"未指定";const s=null==(e=$a.value)?void 0:e.find(e=>e.id.toString()===a.toString());return(null==s?void 0:s.name)||"未指定"},za=a=>{b.push("/accounting")},Aa=async()=>{await ja.refreshReminders()},Ea=()=>{Ta.value=!Ta.value},Wa=a=>new Date(a.reminder_date||a.created_at).toLocaleDateString("zh-TW",{month:"short",day:"numeric"}),Fa=a=>Pa.value.filter(e=>e.type===a).length,Ia=a=>{var e;if(a.crm_id){return`客戶：${Na(a.crm_id)}`}if(a.project_id){const s=null==(e=wa.value)?void 0:e.find(e=>e.id.toString()===a.project_id.toString());return`專案：${(null==s?void 0:s.project_name)||"未知專案"}`}return"系統提醒"};return c(async()=>{await Promise.all([ja.refreshReminders(),ja.fetchCRMList(),ja.fetchProjectList(),ja.fetchAccountReceivable(),ja.fetchAccountPayable()])}),(a,e)=>(m(),l("div",k,[i("div",f,[i("div",_,[e[1]||(e[1]=i("div",{class:"stat-icon"},"📝",-1)),i("div",j,[i("div",C,n(d(La).length),1),e[0]||(e[0]=i("div",{class:"stat-label"},"待辦提醒",-1))])]),i("div",S,[e[3]||(e[3]=i("div",{class:"stat-icon"},"📋",-1)),i("div",L,[i("div",$,n(qa.value.length),1),e[2]||(e[2]=i("div",{class:"stat-label"},"負責專案",-1))])]),i("div",w,[e[5]||(e[5]=i("div",{class:"stat-icon"},"💰",-1)),i("div",x,[i("div",D,n(Pa.value.length),1),e[4]||(e[4]=i("div",{class:"stat-label"},"待處理款項",-1))])])]),i("div",R,[i("div",T,[i("div",q,[e[6]||(e[6]=i("h3",null,"📝 待辦提醒",-1)),i("button",{onClick:Aa,class:"refresh-btn-compact",disabled:Ra.value},[i("span",{class:r(["refresh-icon",{spinning:Ra.value}])},"🔄",2)],8,P)]),i("div",N,[Ra.value?(m(),l("div",z,"載入中...")):0===d(La).length?(m(),l("div",A,e[7]||(e[7]=[i("p",null,"目前沒有待辦事項",-1)]))):(m(),l("div",E,[(m(!0),l(v,null,u(d(La).slice(0,6),a=>(m(),l("div",{key:a.id,class:"reminder-item-compact",onClick:e=>(a=>{a.crm_id?b.push({path:"/crm",query:{client:a.crm_id}}):a.project_id&&b.push({path:"/project",query:{id:a.project_id}})})(a)},[i("div",F,n(Wa(a)),1),i("div",I,[i("div",M,n(Ia(a)),1),i("div",V,n(a.note),1)])],8,W))),128)),d(La).length>6?(m(),l("div",B," 還有 "+n(d(La).length-6)+" 個提醒... ",1)):o("",!0)]))])]),i("div",G,[i("div",H,[e[8]||(e[8]=i("h3",null,"🎯 業務摘要",-1)),i("span",J,n((new Date).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})),1)]),i("div",K,[i("div",O,[i("div",Q,[e[9]||(e[9]=i("span",{class:"section-title"},"📋 負責專案",-1)),i("span",U,n(qa.value.length),1)]),0===qa.value.length?(m(),l("div",X," 目前沒有負責的專案 ")):(m(),l("div",Y,[(m(!0),l(v,null,u(qa.value.slice(0,3),a=>(m(),l("div",{key:a.id,class:"project-row",onClick:e=>(a=>{b.push({path:"/project",query:{id:a.id}})})(a)},[i("div",aa,[i("span",ea,n(a.project_name),1),i("span",sa,n(Na(a.crm_id)),1)]),i("div",ta," NT$ "+n(a.receivable.toLocaleString()),1)],8,Z))),128)),qa.value.length>3?(m(),l("div",ca," 還有 "+n(qa.value.length-3)+" 個專案 ",1)):o("",!0)]))]),i("div",la,[i("div",ia,[e[10]||(e[10]=i("span",{class:"section-title"},"💰 待處理款項",-1)),i("span",na,n(Pa.value.length),1)]),0===Pa.value.length?(m(),l("div",da," 目前沒有待處理款項 ")):(m(),l("div",ra,[i("div",oa,[i("div",va,[e[11]||(e[11]=i("span",{class:"payment-type"},"應收",-1)),i("span",ua,n(Fa("receivable")),1)]),i("div",pa,[e[12]||(e[12]=i("span",{class:"payment-type"},"應付",-1)),i("span",ma,n(Fa("payable")),1)])]),i("div",ya,[(m(!0),l(v,null,u(Pa.value.slice(0,2),a=>(m(),l("div",{key:a.id,class:"payment-item",onClick:a=>za()},[i("span",ga,n(a.description),1),i("span",{class:r(["payment-amount",a.type])}," NT$ "+n(a.amount.toLocaleString()),3)],8,ha))),128))]),Pa.value.length>2?(m(),l("div",{key:0,class:"more-payments",onClick:Ea},n(Ta.value?"收起":`還有 ${Pa.value.length-2} 筆款項,點下展開`),1)):o("",!0),Ta.value?(m(),l("div",ba,[(m(!0),l(v,null,u(Pa.value.slice(2),a=>(m(),l("div",{key:a.id,class:"payment-item",onClick:a=>za()},[i("span",fa,n(a.description),1),i("span",{class:r(["payment-amount",a.type])}," NT$ "+n(a.amount.toLocaleString()),3)],8,ka))),128))])):o("",!0)]))])])])])]))}}),[["__scopeId","data-v-af68d377"]]);export{_a as default};
