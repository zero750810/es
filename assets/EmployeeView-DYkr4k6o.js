import{a as l,r as a,c as e,j as s,e as u,f as n,i as d,z as t,A as i,C as o,F as r,g as v,t as c,y as m,n as p,o as b}from"./vue-CVAoqndi.js";import{b as y,_ as h}from"./index-CCeFhwB-.js";import"./vendor-C7jwa7K6.js";const _={class:"employee"},f={class:"page-header"},w={class:"filters"},g={key:0,class:"loading"},k={key:1,class:"empty-state"},C={key:2,class:"employee-table"},V=["onClick"],S={class:"employee-name"},U={class:"employee-email"},P={class:"salary"},I={class:"modal-header"},L={class:"form-grid"},N={class:"form-column"},x={class:"form-group"},T={class:"form-group"},D=["disabled"],j={key:0,class:"form-group"},q={key:1,class:"form-group"},A={class:"form-group"},$={class:"form-column"},O={class:"form-group"},z={class:"form-group"},E={class:"form-group"},F={class:"form-group"},W={class:"form-group"},B={class:"form-group"},G={class:"modal-actions"},H=["disabled"],J={class:"modal-body"},K={class:"detail-grid"},M={class:"detail-section"},Q={class:"detail-item"},R={class:"detail-item"},X={class:"detail-item"},Y={class:"detail-item"},Z={class:"detail-section"},ll={class:"detail-item"},al={class:"detail-item"},el={class:"detail-item"},sl={class:"detail-section"},ul={class:"detail-item"},nl={class:"salary"},dl={class:"detail-item"},tl={class:"detail-item"},il={class:"detail-section"},ol={class:"detail-item"},rl={class:"detail-item"},vl={key:0,class:"detail-item"},cl={class:"modal-actions"},ml=h(l({__name:"EmployeeView",setup(l){const h=y(),ml=a([]),pl=a(!1),bl=a(""),yl=a(""),hl=a(!1),_l=a(!1),fl=a(!1),wl=a(!1),gl=a(null),kl=a(null),Cl=a({name:"",email:"",password:"",newPassword:"",role:"",pay:0,id_card:"",address:"",birthday:"",insurance:0,insurance_add:0}),Vl=e(()=>{let l=ml.value;return bl.value&&(l=l.filter(l=>l.name.toLowerCase().includes(bl.value.toLowerCase()))),yl.value&&(l=l.filter(l=>l.role===Number(yl.value))),l.sort((l,a)=>l.name.localeCompare(a.name))}),Sl=l=>({0:"role-employee",1:"role-manager",2:"role-admin"}[l]||""),Ul=l=>({0:"一般員工",1:"主管",2:"管理員"}[l]||"未知角色"),Pl=l=>new Date(l).toLocaleDateString("zh-TW"),Il=()=>{hl.value=!1,_l.value=!1,Cl.value={name:"",email:"",password:"",newPassword:"",role:"",pay:0,id_card:"",address:"",birthday:"",insurance:0,insurance_add:0},gl.value=null},Ll=()=>{fl.value=!1,kl.value=null},Nl=async()=>{wl.value=!0;try{if(hl.value){const l={name:Cl.value.name,mail:Cl.value.email,role:Number(Cl.value.role),pay:Cl.value.pay,id_card:Cl.value.id_card,address:Cl.value.address,birthday:Cl.value.birthday?new Date(Cl.value.birthday).toISOString():null,insurance:Cl.value.insurance,insurance_add:Cl.value.insurance_add,deleted_at:null};await h.callAPI({table:"staff",action:"create",data:l})}else gl.value&&(await h.callAPI({table:"staff",action:"update",data:{id:gl.value.id,name:Cl.value.name,role:Number(Cl.value.role),pay:Cl.value.pay,id_card:Cl.value.id_card,address:Cl.value.address,birthday:Cl.value.birthday?new Date(Cl.value.birthday).toISOString():null,insurance:Cl.value.insurance,insurance_add:Cl.value.insurance_add}}),Cl.value.newPassword&&Cl.value.newPassword.trim());await xl(),Il()}catch(l){}finally{wl.value=!1}},xl=async()=>{pl.value=!0;try{const l=await h.callAPI({table:"staff",action:"read"});l&&(ml.value=l.filter(l=>!l.deleted_at))}catch(l){}finally{pl.value=!1}};return s(xl),(l,a)=>(b(),u("div",_,[n("div",f,[a[17]||(a[17]=n("h1",null,"員工管理",-1)),n("button",{onClick:a[0]||(a[0]=l=>hl.value=!0),class:"btn btn-primary"}," 新增員工 ")]),n("div",w,[t(n("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>bl.value=l),type:"text",placeholder:"搜尋員工姓名...",class:"search-input"},null,512),[[i,bl.value]]),t(n("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>yl.value=l),class:"filter-select"},a[18]||(a[18]=[n("option",{value:""},"所有角色",-1),n("option",{value:"0"},"一般員工",-1),n("option",{value:"1"},"主管",-1),n("option",{value:"2"},"管理員",-1)]),512),[[o,yl.value]])]),pl.value?(b(),u("div",g,"載入中...")):0===Vl.value.length?(b(),u("div",k,a[19]||(a[19]=[n("div",{class:"empty-icon"},"👥",-1),n("p",null,"尚無員工資料",-1)]))):(b(),u("div",C,[n("table",null,[a[20]||(a[20]=n("thead",null,[n("tr",null,[n("th",null,"姓名"),n("th",null,"角色"),n("th",null,"薪資"),n("th",null,"加入日期"),n("th",null,"狀態")])],-1)),n("tbody",null,[(b(!0),u(r,null,v(Vl.value,l=>(b(),u("tr",{key:l.id,onClick:a=>(l=>{kl.value=l,fl.value=!0})(l),class:"clickable-row"},[n("td",S,[n("div",null,c(l.name),1),n("div",U,c(l.mail||"未設定信箱"),1)]),n("td",null,[n("span",{class:p(["role-badge",Sl(l.role)])},c(Ul(l.role)),3)]),n("td",P,"NT$ "+c(l.pay?l.pay.toLocaleString():"0"),1),n("td",null,c(Pl(l.created_at)),1),n("td",null,[n("span",{class:p(["status-badge",l.deleted_at?"status-inactive":"status-active"])},c(l.deleted_at?"離職":"在職"),3)])],8,V))),128))])])])),hl.value||_l.value?(b(),u("div",{key:3,class:"modal-overlay edit-modal-overlay",onClick:Il},[n("div",{class:"modal",onClick:a[14]||(a[14]=m(()=>{},["stop"]))},[n("div",I,[n("h2",null,c(hl.value?"新增員工":"編輯員工"),1),n("button",{onClick:Il,class:"close-btn"},"×")]),n("form",{onSubmit:m(Nl,["prevent"]),class:"modal-body"},[n("div",L,[n("div",N,[a[27]||(a[27]=n("h3",{class:"column-title"},"基本資料",-1)),n("div",x,[a[21]||(a[21]=n("label",null,"姓名 *",-1)),t(n("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>Cl.value.name=l),type:"text",required:""},null,512),[[i,Cl.value.name]])]),n("div",T,[a[22]||(a[22]=n("label",null,"電子郵件 *",-1)),t(n("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>Cl.value.email=l),type:"email",required:"",disabled:_l.value},null,8,D),[[i,Cl.value.email]])]),hl.value?(b(),u("div",j,[a[23]||(a[23]=n("label",null,"初始密碼 *",-1)),t(n("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>Cl.value.password=l),type:"password",required:""},null,512),[[i,Cl.value.password]])])):d("",!0),_l.value?(b(),u("div",q,[a[24]||(a[24]=n("label",null,"重設密碼",-1)),t(n("input",{"onUpdate:modelValue":a[6]||(a[6]=l=>Cl.value.newPassword=l),type:"password",placeholder:"留空則不修改"},null,512),[[i,Cl.value.newPassword]])])):d("",!0),n("div",A,[a[26]||(a[26]=n("label",null,"角色 *",-1)),t(n("select",{"onUpdate:modelValue":a[7]||(a[7]=l=>Cl.value.role=l),required:""},a[25]||(a[25]=[n("option",{value:""},"請選擇角色",-1),n("option",{value:"0"},"一般員工",-1),n("option",{value:"1"},"主管",-1),n("option",{value:"2"},"管理員",-1)]),512),[[o,Cl.value.role]])])]),n("div",$,[a[34]||(a[34]=n("h3",{class:"column-title"},"詳細資料",-1)),n("div",O,[a[28]||(a[28]=n("label",null,"薪資",-1)),t(n("input",{"onUpdate:modelValue":a[8]||(a[8]=l=>Cl.value.pay=l),type:"number",min:"0"},null,512),[[i,Cl.value.pay,void 0,{number:!0}]])]),n("div",z,[a[29]||(a[29]=n("label",null,"身分證字號",-1)),t(n("input",{"onUpdate:modelValue":a[9]||(a[9]=l=>Cl.value.id_card=l),type:"text",maxlength:"10"},null,512),[[i,Cl.value.id_card]])]),n("div",E,[a[30]||(a[30]=n("label",null,"生日",-1)),t(n("input",{"onUpdate:modelValue":a[10]||(a[10]=l=>Cl.value.birthday=l),type:"date"},null,512),[[i,Cl.value.birthday]])]),n("div",F,[a[31]||(a[31]=n("label",null,"地址",-1)),t(n("input",{"onUpdate:modelValue":a[11]||(a[11]=l=>Cl.value.address=l),rows:"2"},null,512),[[i,Cl.value.address]])]),n("div",W,[a[32]||(a[32]=n("label",null,"勞健保費用",-1)),t(n("input",{"onUpdate:modelValue":a[12]||(a[12]=l=>Cl.value.insurance=l),type:"number",min:"0"},null,512),[[i,Cl.value.insurance,void 0,{number:!0}]])]),n("div",B,[a[33]||(a[33]=n("label",null,"勞健保加保費用",-1)),t(n("input",{"onUpdate:modelValue":a[13]||(a[13]=l=>Cl.value.insurance_add=l),type:"number",min:"0"},null,512),[[i,Cl.value.insurance_add,void 0,{number:!0}]])])])]),n("div",G,[n("button",{type:"button",onClick:Il,class:"btn btn-outline"}," 取消 "),n("button",{type:"submit",class:"btn btn-primary",disabled:wl.value},c(wl.value?"處理中...":hl.value?"新增":"更新"),9,H)])],32)])])):d("",!0),fl.value&&kl.value?(b(),u("div",{key:4,class:"modal-overlay",onClick:Ll},[n("div",{class:"modal detail-modal",onClick:a[16]||(a[16]=m(()=>{},["stop"]))},[n("div",{class:"modal-header"},[a[35]||(a[35]=n("h2",null,"員工詳細資料",-1)),n("button",{onClick:Ll,class:"close-btn"},"×")]),n("div",J,[n("div",K,[n("div",M,[a[40]||(a[40]=n("h3",null,"基本資料",-1)),n("div",Q,[a[36]||(a[36]=n("label",null,"姓名",-1)),n("span",null,c(kl.value.name),1)]),n("div",R,[a[37]||(a[37]=n("label",null,"電子郵件",-1)),n("span",null,c(kl.value.mail||"未設定"),1)]),n("div",X,[a[38]||(a[38]=n("label",null,"角色",-1)),n("span",{class:p(["role-badge",Sl(kl.value.role)])},c(Ul(kl.value.role)),3)]),n("div",Y,[a[39]||(a[39]=n("label",null,"狀態",-1)),n("span",{class:p(["status-badge",kl.value.deleted_at?"status-inactive":"status-active"])},c(kl.value.deleted_at?"離職":"在職"),3)])]),n("div",Z,[a[44]||(a[44]=n("h3",null,"個人資料",-1)),n("div",ll,[a[41]||(a[41]=n("label",null,"身分證字號",-1)),n("span",null,c(kl.value.id_card||"未設定"),1)]),n("div",al,[a[42]||(a[42]=n("label",null,"生日",-1)),n("span",null,c(kl.value.birthday?Pl(kl.value.birthday):"未設定"),1)]),n("div",el,[a[43]||(a[43]=n("label",null,"地址",-1)),n("span",null,c(kl.value.address||"未設定"),1)])]),n("div",sl,[a[48]||(a[48]=n("h3",null,"薪資與保險",-1)),n("div",ul,[a[45]||(a[45]=n("label",null,"薪資",-1)),n("span",nl,"NT$ "+c(kl.value.pay?kl.value.pay.toLocaleString():"0"),1)]),n("div",dl,[a[46]||(a[46]=n("label",null,"勞健保費用",-1)),n("span",null,"NT$ "+c(kl.value.insurance?kl.value.insurance.toLocaleString():"0"),1)]),n("div",tl,[a[47]||(a[47]=n("label",null,"勞健保加保費用",-1)),n("span",null,"NT$ "+c(kl.value.insurance_add?kl.value.insurance_add.toLocaleString():"0"),1)])]),n("div",il,[a[52]||(a[52]=n("h3",null,"系統資料",-1)),n("div",ol,[a[49]||(a[49]=n("label",null,"員工編號",-1)),n("span",null,c(kl.value.id),1)]),n("div",rl,[a[50]||(a[50]=n("label",null,"建立時間",-1)),n("span",null,c(Pl(kl.value.created_at)),1)]),kl.value.updated_at?(b(),u("div",vl,[a[51]||(a[51]=n("label",null,"最後更新",-1)),n("span",null,c(Pl(kl.value.updated_at)),1)])):d("",!0)])]),n("div",cl,[n("button",{onClick:a[15]||(a[15]=l=>{return a=kl.value,gl.value=a,Cl.value={name:a.name,email:a.mail||"",password:"",newPassword:"",role:a.role.toString(),pay:a.pay||0,id_card:a.id_card||"",address:a.address||"",birthday:a.birthday?new Date(a.birthday).toISOString().split("T")[0]:"",insurance:a.insurance||0,insurance_add:a.insurance_add||0},void(_l.value=!0);var a}),class:"btn btn-primary"}," 編輯員工 "),n("button",{onClick:Ll,class:"btn btn-outline"}," 關閉 ")])])])])):d("",!0)]))}}),[["__scopeId","data-v-3a3409df"]]);export{ml as default};
