import{a as l,r as a,c as e,j as t,e as u,f as s,i as n,z as o,A as i,C as r,F as d,g as v,t as p,y as c,n as m,o as y}from"./vue-DD7UfKtI.js";import{b,_ as f}from"./index-BH4LE6s5.js";import"./vendor-C7jwa7K6.js";const h={class:"employee"},g={class:"page-header"},k={class:"filters"},w={key:0,class:"loading"},C={key:1,class:"empty-state"},_={key:2,class:"employee-table"},V={class:"employee-name"},U={class:"employee-email"},j={class:"salary"},q={class:"actions"},x=["onClick"],A=["onClick"],I={class:"modal-header"},L={class:"form-group"},N={class:"form-group"},S=["disabled"],P={key:0,class:"form-group"},z={class:"form-group"},D={class:"form-group"},T={class:"modal-actions"},E=["disabled"],F=f(l({__name:"EmployeeView",setup(l){const f=b(),F=a([]),W=a(!1),$=a(""),B=a(""),G=a(!1),H=a(!1),J=a(!1),K=a(null),M=a({name:"",email:"",password:"",role:"",pay:0}),O=e(()=>{let l=F.value;return $.value&&(l=l.filter(l=>l.name.toLowerCase().includes($.value.toLowerCase()))),B.value&&(l=l.filter(l=>l.role===Number(B.value))),l.sort((l,a)=>l.name.localeCompare(a.name))}),Q=l=>({0:"一般員工",1:"主管",2:"管理員"}[l]||"未知角色"),R=()=>{G.value=!1,H.value=!1,M.value={name:"",email:"",password:"",role:"",pay:0},K.value=null},X=async()=>{J.value=!0;try{if(G.value){const l={name:M.value.name,mail:M.value.email,role:Number(M.value.role),pay:M.value.pay,deleted_at:null};await f.callAPI({table:"staff",action:"create",data:l})}else K.value&&await f.callAPI({table:"staff",action:"update",data:{id:K.value.id,name:M.value.name,role:Number(M.value.role),pay:M.value.pay}});await Y(),R()}catch(l){}finally{J.value=!1}},Y=async()=>{W.value=!0;try{const l=await f.callAPI({table:"staff",action:"read"});l&&(F.value=l.filter(l=>!l.deleted_at))}catch(l){}finally{W.value=!1}};return t(Y),(l,a)=>(y(),u("div",h,[s("div",g,[a[9]||(a[9]=s("h1",null,"員工管理",-1)),s("button",{onClick:a[0]||(a[0]=l=>G.value=!0),class:"btn btn-primary"}," 新增員工 ")]),s("div",k,[o(s("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>$.value=l),type:"text",placeholder:"搜尋員工姓名...",class:"search-input"},null,512),[[i,$.value]]),o(s("select",{"onUpdate:modelValue":a[2]||(a[2]=l=>B.value=l),class:"filter-select"},a[10]||(a[10]=[s("option",{value:""},"所有角色",-1),s("option",{value:"0"},"一般員工",-1),s("option",{value:"1"},"主管",-1),s("option",{value:"2"},"管理員",-1)]),512),[[r,B.value]])]),W.value?(y(),u("div",w,"載入中...")):0===O.value.length?(y(),u("div",C,a[11]||(a[11]=[s("div",{class:"empty-icon"},"👥",-1),s("p",null,"尚無員工資料",-1)]))):(y(),u("div",_,[s("table",null,[a[12]||(a[12]=s("thead",null,[s("tr",null,[s("th",null,"姓名"),s("th",null,"角色"),s("th",null,"薪資"),s("th",null,"加入日期"),s("th",null,"狀態"),s("th",null,"操作")])],-1)),s("tbody",null,[(y(!0),u(d,null,v(O.value,l=>{return y(),u("tr",{key:l.id},[s("td",V,[s("div",null,p(l.name),1),s("div",U,p(l.mail||"未設定信箱"),1)]),s("td",null,[s("span",{class:m(["role-badge",(e=l.role,{0:"role-employee",1:"role-manager",2:"role-admin"}[e]||"")])},p(Q(l.role)),3)]),s("td",j,"NT$ "+p(l.pay?l.pay.toLocaleString():"0"),1),s("td",null,p((a=l.created_at,new Date(a).toLocaleDateString("zh-TW"))),1),s("td",null,[s("span",{class:m(["status-badge",l.deleted_at?"status-inactive":"status-active"])},p(l.deleted_at?"離職":"在職"),3)]),s("td",q,[s("button",{onClick:a=>(l=>{K.value=l,M.value={name:l.name,email:l.mail,password:"",role:l.role.toString(),pay:l.pay},H.value=!0})(l),class:"btn btn-sm btn-outline"}," 編輯 ",8,x),s("button",{onClick:l=>{},class:"btn btn-sm btn-primary"}," 詳情 ",8,A)])]);var a,e}),128))])])])),G.value||H.value?(y(),u("div",{key:3,class:"modal-overlay",onClick:R},[s("div",{class:"modal",onClick:a[8]||(a[8]=c(()=>{},["stop"]))},[s("div",I,[s("h2",null,p(G.value?"新增員工":"編輯員工"),1),s("button",{onClick:R,class:"close-btn"},"×")]),s("form",{onSubmit:c(X,["prevent"]),class:"modal-body"},[s("div",L,[a[13]||(a[13]=s("label",null,"姓名 *",-1)),o(s("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>M.value.name=l),type:"text",required:""},null,512),[[i,M.value.name]])]),s("div",N,[a[14]||(a[14]=s("label",null,"電子郵件 *",-1)),o(s("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>M.value.email=l),type:"email",required:"",disabled:H.value},null,8,S),[[i,M.value.email]])]),G.value?(y(),u("div",P,[a[15]||(a[15]=s("label",null,"初始密碼 *",-1)),o(s("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>M.value.password=l),type:"password",required:""},null,512),[[i,M.value.password]])])):n("",!0),s("div",z,[a[17]||(a[17]=s("label",null,"角色 *",-1)),o(s("select",{"onUpdate:modelValue":a[6]||(a[6]=l=>M.value.role=l),required:""},a[16]||(a[16]=[s("option",{value:""},"請選擇角色",-1),s("option",{value:"0"},"一般員工",-1),s("option",{value:"1"},"主管",-1),s("option",{value:"2"},"管理員",-1)]),512),[[r,M.value.role]])]),s("div",D,[a[18]||(a[18]=s("label",null,"薪資",-1)),o(s("input",{"onUpdate:modelValue":a[7]||(a[7]=l=>M.value.pay=l),type:"number",min:"0"},null,512),[[i,M.value.pay,void 0,{number:!0}]])]),s("div",T,[s("button",{type:"button",onClick:R,class:"btn btn-outline"}," 取消 "),s("button",{type:"submit",class:"btn btn-primary",disabled:J.value},p(J.value?"處理中...":G.value?"新增":"更新"),9,E)])],32)])])):n("",!0)]))}}),[["__scopeId","data-v-c0fa9982"]]);export{F as default};
