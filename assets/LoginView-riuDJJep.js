import{a,r as e,e as s,f as l,y as o,i as r,z as i,A as d,t,x as u,o as n}from"./vue-CVAoqndi.js";import{u as p,s as m,_ as c}from"./index-DxdkvUcA.js";import"./vendor-C7jwa7K6.js";const v={class:"login-container"},f={class:"login-card"},w={class:"form-group"},b=["disabled"],g={class:"form-group"},h=["disabled"],y={key:0,class:"error-message"},_=["disabled"],E=c(a({__name:"LoginView",setup(a){const c=u(),E=p(),j=e(!1),q=e(""),x=e({email:"",password:""}),V=async()=>{j.value=!0,q.value="";try{const{data:a,error:e}=await m.auth.signInWithPassword({email:x.value.email,password:x.value.password});if(e)throw e;if(!a.user||!a.session)throw new Error("登入失敗：未能取得使用者資料");const{data:s,error:l}=await m.from("staff").select("*").eq("mail",a.user.email).single();if(l||!s)throw new Error("無法載入使用者資料，請聯繫系統管理員");E.$patch({session:a.session,user:s}),c.push("/")}catch(a){q.value=a instanceof Error?a.message:"登入失敗，請檢查您的帳號密碼"}finally{j.value=!1}};return(a,e)=>(n(),s("div",v,[l("div",f,[e[4]||(e[4]=l("div",{class:"login-header"},[l("h1",null,"活動公司 ERP 系統"),l("p",null,"請登入您的帳號")],-1)),l("form",{onSubmit:o(V,["prevent"]),class:"login-form"},[l("div",w,[e[2]||(e[2]=l("label",{for:"email"},"電子郵件",-1)),i(l("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=a=>x.value.email=a),type:"email",required:"",disabled:j.value,placeholder:"請輸入您的電子郵件",autocomplete:"email"},null,8,b),[[d,x.value.email]])]),l("div",g,[e[3]||(e[3]=l("label",{for:"password"},"密碼",-1)),i(l("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>x.value.password=a),type:"password",required:"",disabled:j.value,placeholder:"請輸入您的密碼",autocomplete:"current-password"},null,8,h),[[d,x.value.password]])]),q.value?(n(),s("div",y,t(q.value),1)):r("",!0),l("button",{type:"submit",class:"login-btn",disabled:j.value},t(j.value?"登入中...":"登入"),9,_)],32),e[5]||(e[5]=l("div",{class:"login-footer"},[l("p",null,"忘記密碼？請聯繫系統管理員")],-1))])]))}}),[["__scopeId","data-v-8acd4b24"]]);export{E as default};
