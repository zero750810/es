import{a,v as t,c as l,r as e,j as s,e as n,f as o,z as u,n as i,E as c,i as v,A as d,C as r,t as m,F as p,g as y,y as b,D as k,H as _,G as h,o as w}from"./vue-DD7UfKtI.js";import{a as f,b as g,_ as j}from"./index-BH4LE6s5.js";import"./vendor-C7jwa7K6.js";const C={class:"inventory"},q={class:"page-header"},x={class:"tabs"},V={class:"filters-compact"},U={class:"search-group"},I={class:"status-overview"},L={class:"status-item normal"},A={class:"count"},D={class:"status-item low"},z={class:"count"},S={class:"status-item empty"},T={class:"count"},P={key:0,class:"loading"},E={key:1,class:"empty-state"},F={key:2,class:"inventory-grid-compact"},G={class:"grid-body"},H={class:"item-info"},M={class:"item-name"},W={class:"item-meta"},$={class:"item-type"},B={key:0,class:"item-notes"},J={class:"quantity-section"},K={class:"quantity-number"},N={class:"actions-section"},O=["onClick"],Q=["onClick"],R=["onClick"],X={class:"modal-header"},Y={class:"item-info"},Z={class:"form-group"},aa=["max"],ta={class:"form-group"},la={key:0,class:"preview"},ea={class:"modal-actions"},sa=["disabled"],na={class:"form-group"},oa={class:"form-group"},ua={class:"form-group"},ia={class:"form-group"},ca={class:"form-group"},va={class:"form-group"},da={class:"form-group"},ra={class:"modal-actions"},ma=["disabled"],pa={class:"adjustments-section"},ya={key:0,class:"empty-state"},ba={key:1,class:"adjustments-compact"},ka={class:"adjustments-list"},_a={class:"adj-date"},ha={class:"adj-item"},wa={class:"adj-type"},fa={class:"adj-executor"},ga={class:"adj-note"},ja=j(a({__name:"InventoryView",setup(a){const j=f(),ja=g(),{inventoryList:Ca}=t(j),qa=l(()=>ja.loading.value),xa=e("inventory"),Va=e(""),Ua=e("name"),Ia=e(!1),La=e(!1),Aa=e(null),Da=e("in"),za=e(0),Sa=e(""),Ta=e(!1),Pa=e([]),Ea=e({name:"",type:"",total_stock:0,tag_type:null,status:"active",notes:"",now_stock:0,consumables:!1}),Fa=l(()=>{let a=Ca.value.filter(a=>a.name.toLowerCase().includes(Va.value.toLowerCase()));return a.sort((a,t)=>{if("name"===Ua.value)return a.name.localeCompare(t.name);if("current_quantity"===Ua.value)return t.total_stock-a.total_stock;if("low_stock"===Ua.value){const l=a.total_stock<=10,e=t.total_stock<=10;return l&&!e?-1:!l&&e?1:a.total_stock-t.total_stock}return 0}),a}),Ga=l(()=>!(!Aa.value||za.value<=0)&&!("out"===Da.value&&za.value>Aa.value.total_stock)),Ha=a=>0===a.total_stock?"quantity-zero":a.total_stock<=10?"quantity-low":"quantity-normal",Ma=a=>0===a.total_stock?"status-empty":a.total_stock<=10?"status-low":"status-normal",Wa=a=>0===a.total_stock?"缺貨":a.total_stock<=10?"低庫存":"正常",$a=()=>Aa.value?"in"===Da.value?Aa.value.total_stock+za.value:Aa.value.total_stock-za.value:0,Ba=()=>{const a=$a();return 0===a?"quantity-zero":a<=10?"quantity-low":"quantity-normal"},Ja=a=>Ca.value.filter(t=>"normal"===a?t.total_stock>10:"low"===a?t.total_stock>0&&t.total_stock<=10:"empty"===a&&0===t.total_stock).length,Ka=a=>0===a.total_stock?"card-empty":a.total_stock<=10?"card-low":"card-normal",Na=(a,t)=>{Aa.value=a,Da.value=t,za.value=0,Sa.value="",Ia.value=!0},Oa=()=>{Ia.value=!1,Aa.value=null,za.value=0,Sa.value=""},Qa=()=>{La.value=!1,Ea.value={name:"",type:"",total_stock:0,tag_type:null,status:"active",notes:"",now_stock:0,consumables:!1}},Ra=async()=>{if(Aa.value&&Ga.value){Ta.value=!0;try{await j.updateInventory(Aa.value.id,za.value,Da.value,Sa.value),Oa()}catch(a){}finally{Ta.value=!1}}},Xa=async()=>{Ta.value=!0;try{await ja.callAPI({table:"inventory",action:"create",data:Ea.value}),await j.fetchInventoryList(),Qa()}catch(a){alert("新增失敗，請稍後再試")}finally{Ta.value=!1}},Ya=a=>{const t=Ca.value.find(t=>t.id===String(a));return(null==t?void 0:t.name)||"未知品項"};return s(async()=>{await j.fetchInventoryList(),await(async()=>{try{const a=await ja.callAPI({table:"inventory_adjustment",action:"read"});a&&Array.isArray(a)&&(Pa.value=a.sort((a,t)=>new Date(t.created_at).getTime()-new Date(a.created_at).getTime()))}catch(a){}})()}),(a,t)=>{var l,e,s;return w(),n("div",C,[o("div",q,[t[16]||(t[16]=o("h1",null,"庫存管理",-1)),o("button",{onClick:t[0]||(t[0]=a=>La.value=!0),class:"btn btn-primary"}," 新增品項 ")]),o("div",x,[o("button",{onClick:t[1]||(t[1]=a=>xa.value="inventory"),class:i(["tab-btn",{active:"inventory"===xa.value}])}," 庫存管理 ",2),o("button",{onClick:t[2]||(t[2]=a=>xa.value="adjustments"),class:i(["tab-btn",{active:"adjustments"===xa.value}])}," 異動記錄 ",2)]),u(o("div",null,[o("div",V,[o("div",U,[u(o("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>Va.value=a),type:"text",placeholder:"搜尋品項名稱...",class:"search-input-compact"},null,512),[[d,Va.value]]),u(o("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>Ua.value=a),class:"sort-select-compact"},t[17]||(t[17]=[o("option",{value:"name"},"依名稱排序",-1),o("option",{value:"current_quantity"},"依庫存數量排序",-1),o("option",{value:"low_stock"},"低庫存優先",-1)]),512),[[r,Ua.value]])]),o("div",I,[o("div",L,[o("span",A,m(Ja("normal")),1),t[18]||(t[18]=o("span",{class:"label"},"正常",-1))]),o("div",D,[o("span",z,m(Ja("low")),1),t[19]||(t[19]=o("span",{class:"label"},"低庫存",-1))]),o("div",S,[o("span",T,m(Ja("empty")),1),t[20]||(t[20]=o("span",{class:"label"},"缺貨",-1))])])]),qa.value?(w(),n("div",P,"載入中...")):0===Fa.value.length?(w(),n("div",E,t[21]||(t[21]=[o("div",{class:"empty-icon"},"📦",-1),o("p",null,"尚無庫存品項",-1)]))):(w(),n("div",F,[t[23]||(t[23]=o("div",{class:"grid-header"},[o("div",{class:"header-item"},"品項資訊"),o("div",{class:"header-quantity"},"庫存狀態"),o("div",{class:"header-actions"},"快速操作")],-1)),o("div",G,[(w(!0),n(p,null,y(Fa.value,a=>(w(),n("div",{key:a.id,class:i(["inventory-card-compact",Ka(a)])},[o("div",H,[o("h4",M,m(a.name),1),o("div",W,[o("span",$,m(a.type||"一般物品"),1),a.notes?(w(),n("span",B,m(a.notes),1)):v("",!0)])]),o("div",J,[o("div",{class:i(["quantity-display",Ha(a)])},[o("span",K,m(a.total_stock),1),t[22]||(t[22]=o("span",{class:"quantity-unit"},"個",-1))],2),o("span",{class:i(["status-badge-compact",Ma(a)])},m(Wa(a)),3)]),o("div",N,[o("button",{onClick:t=>Na(a,"in"),class:"btn-action btn-in",title:"入庫"}," ⬆️ ",8,O),o("button",{onClick:t=>Na(a,"out"),class:"btn-action btn-out",title:"出庫"}," ⬇️ ",8,Q),o("button",{onClick:a=>{},class:"btn-action btn-edit",title:"編輯"}," ✏️ ",8,R)])],2))),128))])])),Ia.value?(w(),n("div",{key:3,class:"modal-overlay",onClick:Oa},[o("div",{class:"modal",onClick:t[7]||(t[7]=b(()=>{},["stop"]))},[o("div",X,[o("h2",null,m("in"===Da.value?"入庫":"出庫"),1),o("button",{onClick:Oa,class:"close-btn"},"×")]),o("form",{onSubmit:b(Ra,["prevent"]),class:"modal-body"},[o("div",Y,[o("h3",null,m(null==(l=Aa.value)?void 0:l.name),1),o("p",null,"當前庫存："+m(null==(e=Aa.value)?void 0:e.total_stock)+" 個",1)]),o("div",Z,[o("label",null,m("in"===Da.value?"入庫":"出庫")+"數量 *",1),u(o("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>za.value=a),type:"number",min:"1",max:"out"===Da.value?null==(s=Aa.value)?void 0:s.total_stock:void 0,required:""},null,8,aa),[[d,za.value,void 0,{number:!0}]])]),o("div",ta,[t[24]||(t[24]=o("label",null,"備註",-1)),u(o("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>Sa.value=a),rows:"3",placeholder:"請輸入異動原因或備註"},null,512),[[d,Sa.value]])]),za.value>0?(w(),n("div",la,[o("p",null,[t[25]||(t[25]=k(" 異動後數量： ")),o("strong",{class:i(Ba())},m($a())+" 個 ",3)])])):v("",!0),o("div",ea,[o("button",{type:"button",onClick:Oa,class:"btn btn-outline"}," 取消 "),o("button",{type:"submit",class:i(["btn","in"===Da.value?"btn-success":"btn-warning"]),disabled:Ta.value||!Ga.value},m(Ta.value?"處理中...":"確認"+("in"===Da.value?"入庫":"出庫")),11,sa)])],32)])])):v("",!0),La.value?(w(),n("div",{key:4,class:"modal-overlay",onClick:Qa},[o("div",{class:"modal",onClick:t[15]||(t[15]=b(()=>{},["stop"]))},[o("div",{class:"modal-header"},[t[26]||(t[26]=o("h2",null,"新增庫存品項",-1)),o("button",{onClick:Qa,class:"close-btn"},"×")]),o("form",{onSubmit:b(Xa,["prevent"]),class:"modal-body"},[o("div",na,[t[27]||(t[27]=o("label",null,"品項名稱 *",-1)),u(o("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>Ea.value.name=a),type:"text",required:""},null,512),[[d,Ea.value.name]])]),o("div",oa,[t[28]||(t[28]=o("label",null,"物品類型",-1)),u(o("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>Ea.value.type=a),type:"text",placeholder:"請輸入物品類型"},null,512),[[d,Ea.value.type]])]),o("div",ua,[t[29]||(t[29]=o("label",null,"初始數量",-1)),u(o("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>Ea.value.total_stock=a),type:"number",min:"0"},null,512),[[d,Ea.value.total_stock,void 0,{number:!0}]])]),o("div",ia,[t[30]||(t[30]=o("label",null,"當前庫存",-1)),u(o("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>Ea.value.now_stock=a),type:"number",min:"0"},null,512),[[d,Ea.value.now_stock,void 0,{number:!0}]])]),o("div",ca,[t[32]||(t[32]=o("label",null,"狀態",-1)),u(o("select",{"onUpdate:modelValue":t[12]||(t[12]=a=>Ea.value.status=a)},t[31]||(t[31]=[o("option",{value:"active"},"啟用",-1),o("option",{value:"inactive"},"停用",-1)]),512),[[r,Ea.value.status]])]),o("div",va,[t[33]||(t[33]=o("label",null,"備註",-1)),u(o("textarea",{"onUpdate:modelValue":t[13]||(t[13]=a=>Ea.value.notes=a),rows:"3",placeholder:"請輸入品項備註"},null,512),[[d,Ea.value.notes]])]),o("div",da,[o("label",null,[u(o("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>Ea.value.consumables=a),type:"checkbox"},null,512),[[_,Ea.value.consumables]]),t[34]||(t[34]=k(" 消耗品 "))])]),o("div",ra,[o("button",{type:"button",onClick:Qa,class:"btn btn-outline"}," 取消 "),o("button",{type:"submit",class:"btn btn-primary",disabled:Ta.value},m(Ta.value?"處理中...":"新增"),9,ma)])],32)])])):v("",!0)],512),[[c,"inventory"===xa.value]]),u(o("div",null,[o("div",pa,[t[37]||(t[37]=o("h2",null,"庫存異動記錄",-1)),0===Pa.value.length?(w(),n("div",ya,t[35]||(t[35]=[o("div",{class:"empty-icon"},"📋",-1),o("p",null,"尚無異動記錄",-1)]))):(w(),n("div",ba,[t[36]||(t[36]=h('<div class="adjustments-header" data-v-d7b316ca><div class="header-date" data-v-d7b316ca>日期時間</div><div class="header-item" data-v-d7b316ca>品項</div><div class="header-type" data-v-d7b316ca>類型</div><div class="header-qty" data-v-d7b316ca>數量變化</div><div class="header-executor" data-v-d7b316ca>負責人</div><div class="header-note" data-v-d7b316ca>備註</div></div>',1)),o("div",ka,[(w(!0),n(p,null,y(Pa.value,a=>{return w(),n("div",{key:a.id,class:"adjustment-row"},[o("div",_a,m((l=a.created_at,new Date(l).toLocaleDateString("zh-TW"))),1),o("div",ha,m(Ya(a.inventory_id)),1),o("div",wa,[o("span",{class:i(["adjustment-type-compact",a.type])},m("in"===a.type?"入庫":"出庫"),3)]),o("div",{class:i(["adj-quantity",a.type])},m("in"===a.type?"+":"-")+m(Math.abs(a.adjust_quantity)),3),o("div",fa,m((t=a.executor_id,`員工${t}`)),1),o("div",ga,m(a.note||"-"),1)]);var t,l}),128))])]))])],512),[[c,"adjustments"===xa.value]])])}}}),[["__scopeId","data-v-d7b316ca"]]);export{ja as default};
