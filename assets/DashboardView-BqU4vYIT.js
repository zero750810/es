import{a,v as s,c as e,j as t,e as c,f as l,t as i,l as n,n as d,i as o,F as r,g as v,x as u,o as m}from"./vue-Cvy1YwU9.js";import{u as p,a as y,b as h,_ as b}from"./index-m2nXL6kR.js";import"./vendor-BV1FDJi5.js";const g={class:"dashboard"},k={class:"dashboard-header"},f={class:"welcome-text"},_={class:"stats-overview"},j={class:"stat-card"},w={class:"stat-content"},C={class:"stat-number"},L={class:"stat-card"},x={class:"stat-content"},$={class:"stat-number"},D={class:"stat-card"},R={class:"stat-content"},P={class:"stat-number"},S={class:"stat-card"},T={class:"stat-content"},z={class:"stat-number"},q={class:"main-dashboard-grid"},A={class:"dashboard-card-compact reminders-card"},E={class:"card-header-compact"},N=["disabled"],W={class:"card-content-compact"},F={key:0,class:"loading-state-compact"},I={key:1,class:"empty-state-compact"},M={key:2,class:"reminders-compact"},V={class:"reminder-date"},B={class:"reminder-content"},G={key:0,class:"view-more-compact"},H={class:"dashboard-card-compact business-summary"},J={class:"card-header-compact"},K={class:"summary-date"},O={class:"card-content-compact"},Q={class:"summary-section"},U={class:"section-header"},X={class:"section-count"},Y={key:0,class:"section-empty"},Z={key:1,class:"customers-horizontal"},aa=["onClick"],sa={class:"customer-name"},ea={key:0,class:"customer-id"},ta={key:0,class:"more-chip"},ca={class:"summary-section"},la={class:"section-header"},ia={class:"section-count"},na={key:0,class:"section-empty"},da={key:1,class:"projects-compact"},oa=["onClick"],ra={class:"project-info"},va={class:"project-name"},ua={class:"project-client"},ma={class:"project-amount"},pa={key:0,class:"more-projects"},ya={class:"summary-section"},ha={class:"section-header"},ba={class:"section-count"},ga={key:0,class:"section-empty"},ka={key:1,class:"payments-compact"},fa={class:"payments-summary"},_a={class:"payment-stat receivable"},ja={class:"payment-count"},wa={class:"payment-stat payable"},Ca={class:"payment-count"},La={class:"recent-payments"},xa=["onClick"],$a={class:"payment-desc"},Da={key:0,class:"more-payments"},Ra=b(a({__name:"DashboardView",setup(a){const b=u(),Ra=p(),Pa=y(),Sa=h(),{user:Ta}=s(Ra),{reminders:za,crmList:qa,projectList:Aa,paymentRequests:Ea,accountPayable:Na}=s(Pa),Wa=e(()=>Sa.loading.value),Fa=e(()=>{var a;return(null==(a=Ta.value)?void 0:a.id)&&qa.value?qa.value.filter(a=>a.sales_id===Ta.value.id&&!a.deleted_at):[]}),Ia=e(()=>{var a;return(null==(a=Ta.value)?void 0:a.id)&&Aa.value?Aa.value.filter(a=>a.executor_id===Ta.value.id&&!a.deleted_at&&!a.final):[]}),Ma=e(()=>{var a;const s=[];return(null==(a=Ta.value)?void 0:a.id)?(Ea.value&&Ea.value.forEach(a=>{a.executor_id!==Ta.value.id||a.final||s.push({id:`receivable-${a.id}`,type:"receivable",amount:a.amount||0,description:`客戶：${Va(a.crm_id)}`,data:a})}),Na.value&&Na.value.forEach(a=>{a.executor_id!==Ta.value.id||a.final||s.push({id:`payable-${a.id}`,type:"payable",amount:a.amount||0,description:a.description||"應付款項",data:a})}),s.slice(0,10)):s}),Va=a=>{var s;const e=null==(s=qa.value)?void 0:s.find(s=>s.id===a);return(null==e?void 0:e.name)||"未指定"},Ba=async()=>{await Pa.refreshReminders()},Ga=a=>new Date(a.reminder_date||a.created_at).toLocaleDateString("zh-TW",{month:"short",day:"numeric"}),Ha=a=>Ma.value.filter(s=>s.type===a).length;return t(async()=>{await Promise.all([Pa.refreshReminders(),Pa.fetchCRMList(),Pa.fetchProjectList(),Pa.fetchAccountReceivable(),Pa.fetchAccountPayable()])}),(a,s)=>{var e,t;return m(),c("div",g,[l("div",k,[l("p",f,"歡迎回來，"+i(null==(e=n(Ta))?void 0:e.name)+" / "+i(null==(t=n(Ta))?void 0:t.mail),1)]),l("div",_,[l("div",j,[s[1]||(s[1]=l("div",{class:"stat-icon"},"📝",-1)),l("div",w,[l("div",C,i(n(za).length),1),s[0]||(s[0]=l("div",{class:"stat-label"},"待辦提醒",-1))])]),l("div",L,[s[3]||(s[3]=l("div",{class:"stat-icon"},"👥",-1)),l("div",x,[l("div",$,i(Fa.value.length),1),s[2]||(s[2]=l("div",{class:"stat-label"},"負責客戶",-1))])]),l("div",D,[s[5]||(s[5]=l("div",{class:"stat-icon"},"📋",-1)),l("div",R,[l("div",P,i(Ia.value.length),1),s[4]||(s[4]=l("div",{class:"stat-label"},"負責專案",-1))])]),l("div",S,[s[7]||(s[7]=l("div",{class:"stat-icon"},"💰",-1)),l("div",T,[l("div",z,i(Ma.value.length),1),s[6]||(s[6]=l("div",{class:"stat-label"},"待處理款項",-1))])])]),l("div",q,[l("div",A,[l("div",E,[s[8]||(s[8]=l("h3",null,"📝 待辦提醒",-1)),l("button",{onClick:Ba,class:"refresh-btn-compact",disabled:Wa.value},[l("span",{class:d(["refresh-icon",{spinning:Wa.value}])},"🔄",2)],8,N)]),l("div",W,[Wa.value?(m(),c("div",F,"載入中...")):0===n(za).length?(m(),c("div",I,s[9]||(s[9]=[l("p",null,"目前沒有待辦事項",-1)]))):(m(),c("div",M,[(m(!0),c(r,null,v(n(za).slice(0,6),a=>(m(),c("div",{key:a.id,class:"reminder-item-compact"},[l("div",V,i(Ga(a)),1),l("div",B,i(a.title||a.note),1)]))),128)),n(za).length>6?(m(),c("div",G," 還有 "+i(n(za).length-6)+" 個提醒... ",1)):o("",!0)]))])]),l("div",H,[l("div",J,[s[10]||(s[10]=l("h3",null,"🎯 業務摘要",-1)),l("span",K,i((new Date).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})),1)]),l("div",O,[l("div",Q,[l("div",U,[s[11]||(s[11]=l("span",{class:"section-title"},"👥 負責客戶",-1)),l("span",X,i(Fa.value.length),1)]),0===Fa.value.length?(m(),c("div",Y," 目前沒有負責的客戶 ")):(m(),c("div",Z,[(m(!0),c(r,null,v(Fa.value.slice(0,4),a=>(m(),c("div",{key:a.id,class:"customer-chip",onClick:s=>(a=>{b.push({path:"/crm",query:{client:a.id}})})(a)},[l("span",sa,i(a.name),1),a.company_id?(m(),c("span",ea,i(a.company_id),1)):o("",!0)],8,aa))),128)),Fa.value.length>4?(m(),c("div",ta," +"+i(Fa.value.length-4),1)):o("",!0)]))]),l("div",ca,[l("div",la,[s[12]||(s[12]=l("span",{class:"section-title"},"📋 負責專案",-1)),l("span",ia,i(Ia.value.length),1)]),0===Ia.value.length?(m(),c("div",na," 目前沒有負責的專案 ")):(m(),c("div",da,[(m(!0),c(r,null,v(Ia.value.slice(0,3),a=>(m(),c("div",{key:a.id,class:"project-row",onClick:s=>(a=>{b.push(`/project/${a.id}`)})(a)},[l("div",ra,[l("span",va,i(a.project_name),1),l("span",ua,i(Va(a.crm_id)),1)]),l("div",ma," NT$ "+i(a.receivable.toLocaleString()),1)],8,oa))),128)),Ia.value.length>3?(m(),c("div",pa," 還有 "+i(Ia.value.length-3)+" 個專案 ",1)):o("",!0)]))]),l("div",ya,[l("div",ha,[s[13]||(s[13]=l("span",{class:"section-title"},"💰 待處理款項",-1)),l("span",ba,i(Ma.value.length),1)]),0===Ma.value.length?(m(),c("div",ga," 目前沒有待處理款項 ")):(m(),c("div",ka,[l("div",fa,[l("div",_a,[s[14]||(s[14]=l("span",{class:"payment-type"},"應收",-1)),l("span",ja,i(Ha("receivable")),1)]),l("div",wa,[s[15]||(s[15]=l("span",{class:"payment-type"},"應付",-1)),l("span",Ca,i(Ha("payable")),1)])]),l("div",La,[(m(!0),c(r,null,v(Ma.value.slice(0,2),a=>(m(),c("div",{key:a.id,class:"payment-item",onClick:a=>{b.push("/accounting")}},[l("span",$a,i(a.description),1),l("span",{class:d(["payment-amount",a.type])}," NT$ "+i(a.amount.toLocaleString()),3)],8,xa))),128))]),Ma.value.length>2?(m(),c("div",Da," 還有 "+i(Ma.value.length-2)+" 筆款項 ",1)):o("",!0)]))])])])])])}}}),[["__scopeId","data-v-d5864e43"]]);export{Ra as default};
