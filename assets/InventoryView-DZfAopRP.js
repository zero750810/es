import{a,v as t,c as l,r as e,j as s,e as n,f as o,z as i,n as u,E as c,i as v,A as d,C as r,t as m,F as p,g as y,y as b,D as k,G as _,o as h}from"./vue-Cvy1YwU9.js";import{a as w,b as f,_ as g}from"./index-m2nXL6kR.js";import"./vendor-BV1FDJi5.js";const j={class:"inventory"},C={class:"page-header"},q={class:"tabs"},x={class:"filters-compact"},I={class:"search-group"},V={class:"status-overview"},L={class:"status-item normal"},U={class:"count"},A={class:"status-item low"},D={class:"count"},z={class:"status-item empty"},S={class:"count"},T={key:0,class:"loading"},P={key:1,class:"empty-state"},E={key:2,class:"inventory-grid-compact"},F={class:"grid-body"},G={class:"item-info"},M={class:"item-name"},W={class:"item-meta"},$={class:"item-type"},B={key:0,class:"item-notes"},H={class:"quantity-section"},J={class:"quantity-number"},K={class:"actions-section"},N=["onClick"],O=["onClick"],Q=["onClick"],R={class:"modal-header"},X={class:"item-info"},Y={class:"form-group"},Z=["max"],aa={class:"form-group"},ta={key:0,class:"preview"},la={class:"modal-actions"},ea=["disabled"],sa={class:"form-group"},na={class:"form-group"},oa={class:"modal-actions"},ia=["disabled"],ua={class:"adjustments-section"},ca={key:0,class:"empty-state"},va={key:1,class:"adjustments-compact"},da={class:"adjustments-list"},ra={class:"adj-date"},ma={class:"adj-item"},pa={class:"adj-type"},ya={class:"adj-executor"},ba={class:"adj-note"},ka=g(a({__name:"InventoryView",setup(a){const g=w(),ka=f(),{inventoryList:_a}=t(g),ha=l(()=>ka.loading.value),wa=e("inventory"),fa=e(""),ga=e("name"),ja=e(!1),Ca=e(!1),qa=e(null),xa=e("in"),Ia=e(0),Va=e(""),La=e(!1),Ua=e([]),Aa=e({name:"",total_stock:0,tag_type:null,status:"active",notes:"",now_stock:0,consumables:!1}),Da=l(()=>{let a=_a.value.filter(a=>a.name.toLowerCase().includes(fa.value.toLowerCase()));return a.sort((a,t)=>{if("name"===ga.value)return a.name.localeCompare(t.name);if("current_quantity"===ga.value)return t.total_stock-a.total_stock;if("low_stock"===ga.value){const l=a.total_stock<=10,e=t.total_stock<=10;return l&&!e?-1:!l&&e?1:a.total_stock-t.total_stock}return 0}),a}),za=l(()=>!(!qa.value||Ia.value<=0)&&!("out"===xa.value&&Ia.value>qa.value.total_stock)),Sa=a=>0===a.total_stock?"quantity-zero":a.total_stock<=10?"quantity-low":"quantity-normal",Ta=a=>0===a.total_stock?"status-empty":a.total_stock<=10?"status-low":"status-normal",Pa=a=>0===a.total_stock?"缺貨":a.total_stock<=10?"低庫存":"正常",Ea=()=>qa.value?"in"===xa.value?qa.value.total_stock+Ia.value:qa.value.total_stock-Ia.value:0,Fa=()=>{const a=Ea();return 0===a?"quantity-zero":a<=10?"quantity-low":"quantity-normal"},Ga=a=>_a.value.filter(t=>"normal"===a?t.total_stock>10:"low"===a?t.total_stock>0&&t.total_stock<=10:"empty"===a&&0===t.total_stock).length,Ma=a=>0===a.total_stock?"card-empty":a.total_stock<=10?"card-low":"card-normal",Wa=(a,t)=>{qa.value=a,xa.value=t,Ia.value=0,Va.value="",ja.value=!0},$a=()=>{ja.value=!1,qa.value=null,Ia.value=0,Va.value=""},Ba=()=>{Ca.value=!1,Aa.value={name:"",total_stock:0,tag_type:null,status:"active",notes:"",now_stock:0,consumables:!1}},Ha=async()=>{if(qa.value&&za.value){La.value=!0;try{await g.updateInventory(qa.value.id,Ia.value,xa.value,Va.value),$a()}catch(a){}finally{La.value=!1}}},Ja=async()=>{La.value=!0;try{await ka.callAPI({table:"inventory",action:"create",data:Aa.value}),await g.fetchInventoryList(),Ba()}catch(a){alert("新增失敗，請稍後再試")}finally{La.value=!1}},Ka=a=>{const t=_a.value.find(t=>t.id===String(a));return(null==t?void 0:t.name)||"未知品項"};return s(async()=>{await g.fetchInventoryList(),await(async()=>{try{const a=await ka.callAPI({table:"inventory_adjustment",action:"read"});a&&Array.isArray(a)&&(Ua.value=a.sort((a,t)=>new Date(t.created_at).getTime()-new Date(a.created_at).getTime()))}catch(a){}})()}),(a,t)=>{var l,e,s;return h(),n("div",j,[o("div",C,[t[11]||(t[11]=o("h1",null,"庫存管理",-1)),o("button",{onClick:t[0]||(t[0]=a=>Ca.value=!0),class:"btn btn-primary"}," 新增品項 ")]),o("div",q,[o("button",{onClick:t[1]||(t[1]=a=>wa.value="inventory"),class:u(["tab-btn",{active:"inventory"===wa.value}])}," 庫存管理 ",2),o("button",{onClick:t[2]||(t[2]=a=>wa.value="adjustments"),class:u(["tab-btn",{active:"adjustments"===wa.value}])}," 異動記錄 ",2)]),i(o("div",null,[o("div",x,[o("div",I,[i(o("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>fa.value=a),type:"text",placeholder:"搜尋品項名稱...",class:"search-input-compact"},null,512),[[d,fa.value]]),i(o("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>ga.value=a),class:"sort-select-compact"},t[12]||(t[12]=[o("option",{value:"name"},"依名稱排序",-1),o("option",{value:"current_quantity"},"依庫存數量排序",-1),o("option",{value:"low_stock"},"低庫存優先",-1)]),512),[[r,ga.value]])]),o("div",V,[o("div",L,[o("span",U,m(Ga("normal")),1),t[13]||(t[13]=o("span",{class:"label"},"正常",-1))]),o("div",A,[o("span",D,m(Ga("low")),1),t[14]||(t[14]=o("span",{class:"label"},"低庫存",-1))]),o("div",z,[o("span",S,m(Ga("empty")),1),t[15]||(t[15]=o("span",{class:"label"},"缺貨",-1))])])]),ha.value?(h(),n("div",T,"載入中...")):0===Da.value.length?(h(),n("div",P,t[16]||(t[16]=[o("div",{class:"empty-icon"},"📦",-1),o("p",null,"尚無庫存品項",-1)]))):(h(),n("div",E,[t[18]||(t[18]=o("div",{class:"grid-header"},[o("div",{class:"header-item"},"品項資訊"),o("div",{class:"header-quantity"},"庫存狀態"),o("div",{class:"header-actions"},"快速操作")],-1)),o("div",F,[(h(!0),n(p,null,y(Da.value,a=>(h(),n("div",{key:a.id,class:u(["inventory-card-compact",Ma(a)])},[o("div",G,[o("h4",M,m(a.name),1),o("div",W,[o("span",$,m(a.type||"一般物品"),1),a.notes?(h(),n("span",B,m(a.notes),1)):v("",!0)])]),o("div",H,[o("div",{class:u(["quantity-display",Sa(a)])},[o("span",J,m(a.total_stock),1),t[17]||(t[17]=o("span",{class:"quantity-unit"},"個",-1))],2),o("span",{class:u(["status-badge-compact",Ta(a)])},m(Pa(a)),3)]),o("div",K,[o("button",{onClick:t=>Wa(a,"in"),class:"btn-action btn-in",title:"入庫"}," ⬆️ ",8,N),o("button",{onClick:t=>Wa(a,"out"),class:"btn-action btn-out",title:"出庫"}," ⬇️ ",8,O),o("button",{onClick:a=>{},class:"btn-action btn-edit",title:"編輯"}," ✏️ ",8,Q)])],2))),128))])])),ja.value?(h(),n("div",{key:3,class:"modal-overlay",onClick:$a},[o("div",{class:"modal",onClick:t[7]||(t[7]=b(()=>{},["stop"]))},[o("div",R,[o("h2",null,m("in"===xa.value?"入庫":"出庫"),1),o("button",{onClick:$a,class:"close-btn"},"×")]),o("form",{onSubmit:b(Ha,["prevent"]),class:"modal-body"},[o("div",X,[o("h3",null,m(null==(l=qa.value)?void 0:l.name),1),o("p",null,"當前庫存："+m(null==(e=qa.value)?void 0:e.total_stock)+" 個",1)]),o("div",Y,[o("label",null,m("in"===xa.value?"入庫":"出庫")+"數量 *",1),i(o("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>Ia.value=a),type:"number",min:"1",max:"out"===xa.value?null==(s=qa.value)?void 0:s.total_stock:void 0,required:""},null,8,Z),[[d,Ia.value,void 0,{number:!0}]])]),o("div",aa,[t[19]||(t[19]=o("label",null,"備註",-1)),i(o("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>Va.value=a),rows:"3",placeholder:"請輸入異動原因或備註"},null,512),[[d,Va.value]])]),Ia.value>0?(h(),n("div",ta,[o("p",null,[t[20]||(t[20]=k(" 異動後數量： ")),o("strong",{class:u(Fa())},m(Ea())+" 個 ",3)])])):v("",!0),o("div",la,[o("button",{type:"button",onClick:$a,class:"btn btn-outline"}," 取消 "),o("button",{type:"submit",class:u(["btn","in"===xa.value?"btn-success":"btn-warning"]),disabled:La.value||!za.value},m(La.value?"處理中...":"確認"+("in"===xa.value?"入庫":"出庫")),11,ea)])],32)])])):v("",!0),Ca.value?(h(),n("div",{key:4,class:"modal-overlay",onClick:Ba},[o("div",{class:"modal",onClick:t[10]||(t[10]=b(()=>{},["stop"]))},[o("div",{class:"modal-header"},[t[21]||(t[21]=o("h2",null,"新增庫存品項",-1)),o("button",{onClick:Ba,class:"close-btn"},"×")]),o("form",{onSubmit:b(Ja,["prevent"]),class:"modal-body"},[o("div",sa,[t[22]||(t[22]=o("label",null,"品項名稱 *",-1)),i(o("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>Aa.value.name=a),type:"text",required:""},null,512),[[d,Aa.value.name]])]),o("div",na,[t[23]||(t[23]=o("label",null,"初始數量",-1)),i(o("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>Aa.value.total_stock=a),type:"number",min:"0"},null,512),[[d,Aa.value.total_stock,void 0,{number:!0}]])]),o("div",oa,[o("button",{type:"button",onClick:Ba,class:"btn btn-outline"}," 取消 "),o("button",{type:"submit",class:"btn btn-primary",disabled:La.value},m(La.value?"處理中...":"新增"),9,ia)])],32)])])):v("",!0)],512),[[c,"inventory"===wa.value]]),i(o("div",null,[o("div",ua,[t[26]||(t[26]=o("h2",null,"庫存異動記錄",-1)),0===Ua.value.length?(h(),n("div",ca,t[24]||(t[24]=[o("div",{class:"empty-icon"},"📋",-1),o("p",null,"尚無異動記錄",-1)]))):(h(),n("div",va,[t[25]||(t[25]=_('<div class="adjustments-header" data-v-9508463b><div class="header-date" data-v-9508463b>日期時間</div><div class="header-item" data-v-9508463b>品項</div><div class="header-type" data-v-9508463b>類型</div><div class="header-qty" data-v-9508463b>數量變化</div><div class="header-executor" data-v-9508463b>負責人</div><div class="header-note" data-v-9508463b>備註</div></div>',1)),o("div",da,[(h(!0),n(p,null,y(Ua.value,a=>{return h(),n("div",{key:a.id,class:"adjustment-row"},[o("div",ra,m((l=a.created_at,new Date(l).toLocaleDateString("zh-TW"))),1),o("div",ma,m(Ka(a.inventory_id)),1),o("div",pa,[o("span",{class:u(["adjustment-type-compact",a.type])},m("in"===a.type?"入庫":"出庫"),3)]),o("div",{class:u(["adj-quantity",a.type])},m("in"===a.type?"+":"-")+m(Math.abs(a.adjust_quantity)),3),o("div",ya,m((t=a.executor_id,`員工${t}`)),1),o("div",ba,m(a.note||"-"),1)]);var t,l}),128))])]))])],512),[[c,"adjustments"===wa.value]])])}}}),[["__scopeId","data-v-9508463b"]]);export{ka as default};
