import{a,s as e,c as l,r as t,l as s,f as o,g as n,z as u,n as i,H as c,j as d,A as v,C as r,F as m,h as p,y as b,t as y,I as k,D as _,G as h,E as f,o as g}from"./vue-B-cAkLc6.js";import{a as w,b as j,_ as x}from"./index-BVk54o67.js";import"./vendor-C7jwa7K6.js";const C={class:"inventory"},q={class:"page-header"},V={class:"tabs"},U={class:"filters-compact"},I={class:"search-group"},L={key:0,class:"loading"},A={key:1,class:"empty-state"},P={key:2,class:"inventory-grid-compact"},D={class:"grid-body"},N={class:"item-info"},z={class:"item-header"},S={class:"item-name"},T={class:"item-type"},E={key:0,class:"consumable-badge"},$={key:0,class:"item-meta"},F={class:"item-notes"},G={class:"quantity-section"},H={class:"quantity-number"},M={class:"actions-section"},W=["onClick"],B=["onClick"],J=["onClick"],K={class:"modal-header"},O={class:"item-info"},Q={key:0,class:"consumable-warning"},R={key:0,class:"form-group"},X={class:"radio-group"},Y={class:"radio-item"},Z={class:"radio-item"},aa={class:"form-group"},ea=["max"],la={class:"form-group"},ta={key:1,class:"preview"},sa={class:"modal-actions"},oa=["disabled"],na={class:"form-row"},ua={class:"form-group"},ia={class:"form-group"},ca=["value"],da={class:"form-row"},va={class:"form-group"},ra={class:"form-group"},ma={class:"form-row"},pa={class:"form-group"},ba={class:"form-group checkbox-group"},ya={class:"checkbox-label"},ka={class:"form-group"},_a={class:"modal-actions"},ha=["disabled"],fa={class:"form-row"},ga={class:"form-group"},wa={class:"form-group"},ja=["value"],xa={class:"form-row"},Ca={class:"form-group"},qa={class:"form-group"},Va={class:"form-row"},Ua={class:"form-group"},Ia={class:"form-group checkbox-group"},La={class:"checkbox-label"},Aa={class:"form-group"},Pa={class:"modal-actions"},Da=["disabled"],Na={class:"adjustments-section"},za={key:0,class:"empty-state"},Sa={key:1,class:"adjustments-compact"},Ta={class:"adjustments-list"},Ea={class:"adj-date"},$a={class:"adj-item"},Fa={class:"adj-type"},Ga={class:"adj-executor"},Ha={class:"adj-project"},Ma={class:"adj-note"},Wa=x(a({__name:"InventoryView",setup(a){const x=w(),Wa=j(),{inventoryList:Ba,tags:Ja}=e(x),Ka=l(()=>Wa.loading.value),Oa=l(()=>(Ja.value||[]).filter(a=>"inventory"===a.type&&!a.deleted_at)),Qa=t("inventory"),Ra=t(""),Xa=t("name"),Ya=t(!1),Za=t(!1),ae=t(!1),ee=t(null),le=t(null),te=t("in"),se=t(0),oe=t(""),ne=t("return"),ue=t(!1),ie=t([]),ce=t({name:"",tag_type:null,total_stock:0,status:"active",notes:"",now_stock:0,consumables:!1}),de=l(()=>{let a=Ba.value.filter(a=>a.name.toLowerCase().includes(Ra.value.toLowerCase()));return a.sort((a,e)=>{if("name"===Xa.value)return a.name.localeCompare(e.name);if("current_quantity"===Xa.value)return e.total_stock-a.total_stock;if("low_stock"===Xa.value){const l=a.total_stock<=10,t=e.total_stock<=10;return l&&!t?-1:!l&&t?1:a.total_stock-e.total_stock}return 0}),a}),ve=l(()=>!(!ee.value||se.value<=0)&&!("out"===te.value&&se.value>ee.value.total_stock)),re=a=>0===a.total_stock?"quantity-zero":a.total_stock<=10?"quantity-low":"quantity-normal",me=()=>ee.value?"in"===te.value?ee.value.total_stock+se.value:ee.value.total_stock-se.value:0,pe=()=>{const a=me();return 0===a?"quantity-zero":a<=10?"quantity-low":"quantity-normal"},be=a=>0===a.total_stock?"card-empty":a.total_stock<=10?"card-low":"card-normal",ye=(a,e)=>{ee.value=a,te.value=e,se.value=0,oe.value="",Ya.value=!0},ke=()=>{Ya.value=!1,ee.value=null,se.value=0,oe.value="",ne.value="return"},_e=()=>{Za.value=!1,fe()},he=()=>{ae.value=!1,le.value=null,fe()},fe=()=>{ce.value={name:"",tag_type:null,total_stock:0,status:"active",notes:"",now_stock:0,consumables:!1}},ge=async()=>{if(ee.value&&ve.value){ue.value=!0;try{const a=ee.value,e=a.consumables;let l=a.now_stock||0,t=a.total_stock;"in"===te.value?(l+=se.value,"new"===ne.value&&(t+=se.value)):(l-=se.value,e&&(t-=se.value)),await Wa.callAPI({table:"inventory",action:"update",data:{id:Number(a.id),now_stock:l,total_stock:t}}),await Wa.callAPI({table:"inventory_adjustment",action:"create",data:{inventory_id:Number(a.id),adjust_quantity:"in"===te.value?se.value:-se.value,executor_id:1,type:"in"===te.value?"new"===ne.value?"new_in":"return_in":e?"consume_out":"borrow_out",project_id:null}}),await x.fetchInventoryList(),ke()}catch(a){alert("異動失敗，請稍後再試")}finally{ue.value=!1}}},we=async()=>{ue.value=!0;try{le.value?(await Wa.callAPI({table:"inventory",action:"update",data:{id:le.value.id,...ce.value}}),await x.fetchInventoryList(),he()):(await Wa.callAPI({table:"inventory",action:"create",data:ce.value}),await x.fetchInventoryList(),_e())}catch(a){alert("儲存失敗，請稍後再試")}finally{ue.value=!1}},je=a=>{const e=Ba.value.find(e=>Number(e.id)===Number(a));return(null==e?void 0:e.name)||"未知品項"},xe=a=>{var e;if(!a)return"未指定";const l=null==(e=x.employee)?void 0:e.find(e=>e.id===a);return l?l.name:`員工ID: ${a}`},Ce=a=>{var e;if(!a)return"-";const l=null==(e=x.projectList)?void 0:e.find(e=>Number(e.id)===Number(a));return l?l.project_name:`專案ID: ${a}`},qe=a=>{const e=a.tag_type;if(!e)return"一般物品";const l=Oa.value.find(a=>a.id===e);return l?l.name:"一般物品"},Ve=async()=>{try{const a=await Wa.callAPI({table:"inventory_adjustment",action:"read"});a&&Array.isArray(a)&&(ie.value=a.sort((a,e)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()))}catch(a){}};return s(async()=>{await Promise.all([x.fetchInventoryList(),x.fetchTagList(),x.fetchEmployeeList(),x.fetchProjectList(),Ve()])}),(a,e)=>{var l,t,s,w,j;return g(),o("div",C,[n("div",q,[e[26]||(e[26]=n("h1",null,"庫存管理",-1)),n("button",{onClick:e[0]||(e[0]=a=>Za.value=!0),class:"btn btn-primary"}," 新增品項 ")]),n("div",V,[n("button",{onClick:e[1]||(e[1]=a=>Qa.value="inventory"),class:i(["tab-btn",{active:"inventory"===Qa.value}])}," 庫存管理 ",2),n("button",{onClick:e[2]||(e[2]=a=>Qa.value="adjustments"),class:i(["tab-btn",{active:"adjustments"===Qa.value}])}," 異動記錄 ",2)]),u(n("div",null,[n("div",U,[n("div",I,[u(n("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>Ra.value=a),type:"text",placeholder:"搜尋品項名稱...",class:"search-input-compact"},null,512),[[v,Ra.value]]),u(n("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>Xa.value=a),class:"sort-select-compact"},e[27]||(e[27]=[n("option",{value:"name"},"依名稱排序",-1),n("option",{value:"current_quantity"},"依庫存數量排序",-1),n("option",{value:"low_stock"},"低庫存優先",-1)]),512),[[r,Xa.value]])])]),Ka.value?(g(),o("div",L,"載入中...")):0===de.value.length?(g(),o("div",A,e[28]||(e[28]=[n("div",{class:"empty-icon"},"📦",-1),n("p",null,"尚無庫存品項",-1)]))):(g(),o("div",P,[e[29]||(e[29]=n("div",{class:"grid-header"},[n("div",{class:"header-item"},"品項資訊"),n("div",{class:"header-quantity"},"現有 / 應有庫存"),n("div",{class:"header-actions"},"快速操作")],-1)),n("div",D,[(g(!0),o(m,null,p(de.value,a=>(g(),o("div",{key:a.id,class:i(["inventory-card-compact",be(a)])},[n("div",N,[n("div",z,[n("h4",S,y(a.name),1),n("span",T,y(qe(a)),1),a.consumables?(g(),o("span",E,"消耗品")):d("",!0)]),a.notes?(g(),o("div",$,[n("span",F,y(a.notes),1)])):d("",!0)]),n("div",G,[n("div",{class:i(["quantity-display",re(a)])},[n("span",H,y(a.now_stock)+" / "+y(a.total_stock),1)],2)]),n("div",M,[n("button",{onClick:e=>ye(a,"in"),class:"btn-action btn-in",title:"入庫"}," 入庫 ",8,W),n("button",{onClick:e=>ye(a,"out"),class:"btn-action btn-out",title:"出庫"}," 出庫 ",8,B),n("button",{onClick:e=>(a=>{le.value=a,ce.value={name:a.name,tag_type:a.tag_type||null,total_stock:a.total_stock,status:a.status||"active",notes:a.notes||"",now_stock:a.now_stock||a.total_stock,consumables:a.consumables||!1},ae.value=!0})(a),class:"btn-action btn-edit",title:"編輯"}," 編輯 ",8,J)])],2))),128))])])),Ya.value?(g(),o("div",{key:3,class:"modal-overlay",onClick:ke},[n("div",{class:"modal",onClick:e[9]||(e[9]=b(()=>{},["stop"]))},[n("div",K,[n("h2",null,y("in"===te.value?"入庫":"出庫"),1),n("button",{onClick:ke,class:"close-btn"},"×")]),n("form",{onSubmit:b(ge,["prevent"]),class:"modal-body"},[n("div",O,[n("h3",null,y(null==(l=ee.value)?void 0:l.name),1),n("p",null,"當前庫存："+y((null==(t=ee.value)?void 0:t.now_stock)||0)+" / "+y(null==(s=ee.value)?void 0:s.total_stock)+" 個",1),(null==(w=ee.value)?void 0:w.consumables)?(g(),o("p",Q,"⚠️ 此為消耗品")):d("",!0)]),"in"===te.value?(g(),o("div",R,[e[32]||(e[32]=n("label",null,"入庫類型 *",-1)),n("div",X,[n("label",Y,[u(n("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>ne.value=a),type:"radio",value:"return",name:"inbound-type"},null,512),[[k,ne.value]]),e[30]||(e[30]=n("span",null,"歸還（增加現有數量，總數不變）",-1))]),n("label",Z,[u(n("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>ne.value=a),type:"radio",value:"new",name:"inbound-type"},null,512),[[k,ne.value]]),e[31]||(e[31]=n("span",null,"新增（增加現有數量和總數）",-1))])])])):d("",!0),n("div",aa,[n("label",null,y("in"===te.value?"入庫":"出庫")+"數量 *",1),u(n("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>se.value=a),type:"number",min:"1",max:"out"===te.value?null==(j=ee.value)?void 0:j.now_stock:void 0,required:""},null,8,ea),[[v,se.value,void 0,{number:!0}]])]),n("div",la,[e[33]||(e[33]=n("label",null,"備註",-1)),u(n("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>oe.value=a),rows:"3",placeholder:"請輸入異動原因或備註"},null,512),[[v,oe.value]])]),se.value>0?(g(),o("div",ta,[n("p",null,[e[34]||(e[34]=_(" 異動後數量： ")),n("strong",{class:i(pe())},y(me())+" 個 ",3)])])):d("",!0),n("div",sa,[n("button",{type:"button",onClick:ke,class:"btn btn-outline"}," 取消 "),n("button",{type:"submit",class:i(["btn","in"===te.value?"btn-success":"btn-warning"]),disabled:ue.value||!ve.value},y(ue.value?"處理中...":"確認"+("in"===te.value?"入庫":"出庫")),11,oa)])],32)])])):d("",!0),Za.value?(g(),o("div",{key:4,class:"modal-overlay",onClick:_e},[n("div",{class:"modal add-item-modal",onClick:e[17]||(e[17]=b(()=>{},["stop"]))},[n("div",{class:"modal-header"},[e[35]||(e[35]=n("h2",null,"新增庫存品項",-1)),n("button",{onClick:_e,class:"close-btn"},"×")]),n("form",{onSubmit:b(we,["prevent"]),class:"modal-body"},[n("div",na,[n("div",ua,[e[36]||(e[36]=n("label",null,"品項名稱 *",-1)),u(n("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>ce.value.name=a),type:"text",required:"",placeholder:"請輸入品項名稱"},null,512),[[v,ce.value.name]])]),n("div",ia,[e[38]||(e[38]=n("label",null,"物品類型",-1)),u(n("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>ce.value.tag_type=a)},[e[37]||(e[37]=n("option",{value:""},"請選擇類型",-1)),(g(!0),o(m,null,p(Oa.value,a=>(g(),o("option",{key:a.id,value:a.id},y(a.name),9,ca))),128))],512),[[r,ce.value.tag_type]])])]),n("div",da,[n("div",va,[e[39]||(e[39]=n("label",null,"總庫存量 *",-1)),u(n("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>ce.value.total_stock=a),type:"number",min:"0",required:"",placeholder:"0"},null,512),[[v,ce.value.total_stock,void 0,{number:!0}]])]),n("div",ra,[e[40]||(e[40]=n("label",null,"當前庫存",-1)),u(n("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>ce.value.now_stock=a),type:"number",min:"0",placeholder:"0"},null,512),[[v,ce.value.now_stock,void 0,{number:!0}]])])]),n("div",ma,[n("div",pa,[e[42]||(e[42]=n("label",null,"狀態",-1)),u(n("select",{"onUpdate:modelValue":e[14]||(e[14]=a=>ce.value.status=a)},e[41]||(e[41]=[n("option",{value:"active"},"啟用",-1),n("option",{value:"inactive"},"停用",-1)]),512),[[r,ce.value.status]])]),n("div",ba,[n("label",ya,[u(n("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>ce.value.consumables=a),type:"checkbox"},null,512),[[h,ce.value.consumables]]),e[43]||(e[43]=n("span",{class:"checkbox-text"},"消耗品",-1))])])]),n("div",ka,[e[44]||(e[44]=n("label",null,"備註",-1)),u(n("textarea",{"onUpdate:modelValue":e[16]||(e[16]=a=>ce.value.notes=a),rows:"3",placeholder:"請輸入品項備註或說明"},null,512),[[v,ce.value.notes]])]),n("div",_a,[n("button",{type:"button",onClick:_e,class:"btn btn-outline"}," 取消 "),n("button",{type:"submit",class:"btn btn-primary",disabled:ue.value},y(ue.value?"處理中...":"新增品項"),9,ha)])],32)])])):d("",!0),ae.value?(g(),o("div",{key:5,class:"modal-overlay",onClick:he},[n("div",{class:"modal add-item-modal",onClick:e[25]||(e[25]=b(()=>{},["stop"]))},[n("div",{class:"modal-header"},[e[45]||(e[45]=n("h2",null,"編輯庫存品項",-1)),n("button",{onClick:he,class:"close-btn"},"×")]),n("form",{onSubmit:b(we,["prevent"]),class:"modal-body"},[n("div",fa,[n("div",ga,[e[46]||(e[46]=n("label",null,"品項名稱 *",-1)),u(n("input",{"onUpdate:modelValue":e[18]||(e[18]=a=>ce.value.name=a),type:"text",required:"",placeholder:"請輸入品項名稱"},null,512),[[v,ce.value.name]])]),n("div",wa,[e[48]||(e[48]=n("label",null,"物品類型",-1)),u(n("select",{"onUpdate:modelValue":e[19]||(e[19]=a=>ce.value.tag_type=a)},[e[47]||(e[47]=n("option",{value:""},"請選擇類型",-1)),(g(!0),o(m,null,p(Oa.value,a=>(g(),o("option",{key:a.id,value:a.id},y(a.name),9,ja))),128))],512),[[r,ce.value.tag_type]])])]),n("div",xa,[n("div",Ca,[e[49]||(e[49]=n("label",null,"總庫存量 *",-1)),u(n("input",{"onUpdate:modelValue":e[20]||(e[20]=a=>ce.value.total_stock=a),type:"number",min:"0",required:"",placeholder:"0"},null,512),[[v,ce.value.total_stock,void 0,{number:!0}]])]),n("div",qa,[e[50]||(e[50]=n("label",null,"當前庫存",-1)),u(n("input",{"onUpdate:modelValue":e[21]||(e[21]=a=>ce.value.now_stock=a),type:"number",min:"0",placeholder:"0"},null,512),[[v,ce.value.now_stock,void 0,{number:!0}]])])]),n("div",Va,[n("div",Ua,[e[52]||(e[52]=n("label",null,"狀態",-1)),u(n("select",{"onUpdate:modelValue":e[22]||(e[22]=a=>ce.value.status=a)},e[51]||(e[51]=[n("option",{value:"active"},"啟用",-1),n("option",{value:"inactive"},"停用",-1)]),512),[[r,ce.value.status]])]),n("div",Ia,[n("label",La,[u(n("input",{"onUpdate:modelValue":e[23]||(e[23]=a=>ce.value.consumables=a),type:"checkbox"},null,512),[[h,ce.value.consumables]]),e[53]||(e[53]=n("span",{class:"checkbox-text"},"消耗品",-1))])])]),n("div",Aa,[e[54]||(e[54]=n("label",null,"備註",-1)),u(n("textarea",{"onUpdate:modelValue":e[24]||(e[24]=a=>ce.value.notes=a),rows:"3",placeholder:"請輸入品項備註或說明"},null,512),[[v,ce.value.notes]])]),n("div",Pa,[n("button",{type:"button",onClick:he,class:"btn btn-outline"}," 取消 "),n("button",{type:"submit",class:"btn btn-primary",disabled:ue.value},y(ue.value?"處理中...":"更新品項"),9,Da)])],32)])])):d("",!0)],512),[[c,"inventory"===Qa.value]]),u(n("div",null,[n("div",Na,[e[57]||(e[57]=n("h2",null,"庫存異動記錄",-1)),0===ie.value.length?(g(),o("div",za,e[55]||(e[55]=[n("div",{class:"empty-icon"},"📋",-1),n("p",null,"尚無異動記錄",-1)]))):(g(),o("div",Sa,[e[56]||(e[56]=f('<div class="adjustments-header" data-v-04717e45><div class="header-date" data-v-04717e45>日期時間</div><div class="header-item" data-v-04717e45>品項</div><div class="header-type" data-v-04717e45>類型</div><div class="header-qty" data-v-04717e45>數量變化</div><div class="header-executor" data-v-04717e45>負責人</div><div class="header-executor" data-v-04717e45>對應專案</div><div class="header-note" data-v-04717e45>備註</div></div>',1)),n("div",Ta,[(g(!0),o(m,null,p(ie.value,a=>{return g(),o("div",{key:a.id,class:"adjustment-row"},[n("div",Ea,y((e=a.created_at,new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1),n("div",$a,y(je(a.inventory_id)),1),n("div",Fa,[n("span",{class:i(["adjustment-type-compact",a.type])},y("in"===a.type?"入庫":"出庫"),3)]),n("div",{class:i(["adj-quantity",a.type])},y("in"===a.type?"+":"-")+y(Math.abs(a.adjust_quantity)),3),n("div",Ga,y(xe(a.executor_id)),1),n("div",Ha,y(Ce(a.project_id)),1),n("div",Ma,y(a.note||"-"),1)]);var e}),128))])]))])],512),[[c,"adjustments"===Qa.value]])])}}}),[["__scopeId","data-v-04717e45"]]);export{Wa as default};
