import{a,r as e,c as l,B as t,j as s,e as n,i as c,f as i,t as o,n as d,y as u,z as r,A as m,C as v,F as p,g as b,D as y,E as f,o as h,v as _,k,l as w}from"./vue-Cvy1YwU9.js";import{b as C,a as g,_ as x}from"./index-m2nXL6kR.js";import"./vendor-BV1FDJi5.js";const U={class:"modal-header"},V={class:"header-info"},L={class:"customer-name"},j={class:"modal-content"},I={class:"sidebar"},A={class:"card"},P={class:"card-header"},M={class:"card-content"},S={class:"form-field"},q={class:"form-field"},R={class:"form-field"},D={class:"form-field"},B=["value"],T={class:"form-actions"},$={key:1,class:"info-display-compact"},E={class:"info-grid-pairs"},z={class:"info-pair"},F={class:"info-item-compact"},N={class:"info-item-compact"},W={class:"info-pair"},G={class:"info-item-compact"},H={class:"info-pair"},J={class:"info-item-compact full-width"},K={class:"card"},O={class:"card-header"},Q={class:"card-content"},X={key:0,class:"empty-state"},Y={key:1,class:"contact-list-compact"},Z={class:"contact-info-compact"},aa={class:"contact-main"},ea={class:"contact-name"},la={class:"contact-position"},ta={class:"contact-details-compact"},sa={key:0,class:"contact-phone"},na={key:1,class:"contact-email"},ca={class:"contact-actions-compact"},ia=["onClick"],oa=["onClick"],da={class:"main-content"},ua={class:"first-row"},ra={class:"card half-width-card"},ma={class:"card-header"},va={class:"count-badge"},pa={class:"card-content compact-content"},ba={key:0,class:"empty-state-compact"},ya={key:1,class:"project-list-compact"},fa={class:"project-content-compact"},ha={class:"project-name-compact"},_a={class:"project-meta-compact"},ka={class:"project-amount-compact"},wa={class:"project-date-compact"},Ca=["onClick"],ga={key:0,class:"show-more-compact"},xa={class:"card half-width-card"},Ua={class:"card-header"},Va={class:"card-content compact-content"},La={key:0,class:"empty-state-compact"},ja={key:1,class:"reminder-list-compact"},Ia={class:"reminder-main-compact"},Aa={class:"reminder-time-compact"},Pa={class:"reminder-text-compact"},Ma={class:"reminder-actions-compact"},Sa=["onClick"],qa=["onClick"],Ra={key:0,class:"show-more-compact"},Da={key:0},Ba={key:1},Ta={class:"second-row"},$a={class:"card full-width-card"},Ea={class:"card-header"},za={class:"card-content"},Fa={key:0,class:"empty-state"},Na={key:1,class:"timeline"},Wa={class:"timeline-content"},Ga={class:"timeline-header"},Ha={class:"timeline-date"},Ja={class:"timeline-user"},Ka={class:"timeline-text"},Oa={key:0,class:"timeline-more"},Qa={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},Xa=["d"],Ya={class:"timeline-collapsed"},Za={class:"timeline-content"},ae={class:"timeline-header"},ee={class:"timeline-date"},le={class:"timeline-user"},te={class:"timeline-text"},se={key:0,class:"sub-modal"},ne={class:"sub-modal-content"},ce={class:"sub-modal-header"},ie={class:"form-row"},oe={class:"form-field"},de={class:"form-field"},ue={class:"form-row"},re={class:"form-field"},me={class:"form-field"},ve={key:1,class:"sub-modal"},pe={class:"sub-modal-content"},be={class:"sub-modal-header"},ye={class:"form-field"},fe={class:"form-actions"},he={key:2,class:"sub-modal"},_e={class:"sub-modal-content"},ke={class:"sub-modal-header"},we={class:"form-field"},Ce={class:"form-field"},ge={class:"form-field"},xe={class:"form-actions"},Ue=x(a({__name:"CRMDetailModal",props:{visible:{type:Boolean},customer:{}},emits:["close","updated"],setup(a,{emit:_}){const k=a,w=_,x=C(),Ue=g(),Ve=e(!1),Le=e(!1),je=e(!1),Ie=e(!1),Ae=e(null),Pe=e(!1);e(!1);const Me=e([]),Se=e([]),qe=e([]),Re=l(()=>Ue.employee||[]);l(()=>Ue.employee||[]);const De=l(()=>Ue.projectList||[]),Be=l(()=>Se.value.slice(0,3)),Te=l(()=>Se.value.slice(3)),$e=l(()=>qe.value.filter(a=>!a.final)),Ee=l(()=>qe.value.filter(a=>a.final)),ze=l(()=>{var a;return(null==(a=k.customer)?void 0:a.id)?De.value.filter(a=>a.crm_id===k.customer.id):[]}),Fe=a=>{if(!a)return"æœªè¨­å®š";const e=Re.value.find(e=>e.id===a);return e?e.name:"æœªè¨­å®š"},Ne=e({name:"",company_id:"",address:"",sales_id:null}),We=e({name:"",position:"",phone:"",mail:""}),Ge=e({note:""}),He=e({start_time:"",end_time:"",note:""});t(()=>k.customer,async a=>{a&&(Ne.value={name:a.name,company_id:a.company_id||"",address:a.address||"",sales_id:a.sales_id||null},await Je())},{immediate:!0});const Je=async()=>{if(k.customer)try{const a=await x.callAPI({table:"crm_contact_person",action:"read",filters:{crm_id:k.customer.id}});Me.value=a||[];const e=await x.callAPI({table:"contact_record",action:"read",filters:{crm_id:k.customer.id}});Se.value=e||[];const l=await x.callAPI({table:"reminder",action:"read",filters:{crm_id:k.customer.id}});qe.value=l||[]}catch(a){}},Ke=()=>{w("close")},Oe=async()=>{if(k.customer)try{await x.callAPI({table:"crm",action:"update",data:{id:k.customer.id,...Ne.value}}),Ve.value=!1,w("updated")}catch(a){alert("æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},Qe=()=>{Le.value=!1,Ae.value=null,We.value={name:"",position:"",phone:"",mail:""}},Xe=async()=>{if(k.customer)try{Ae.value?await x.callAPI({table:"crm_contact_person",action:"update",data:{id:Ae.value.id,...We.value}}):await x.callAPI({table:"crm_contact_person",action:"create",data:{crm_id:k.customer.id,...We.value}}),await Je(),Qe()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},Ye=async()=>{if(k.customer)try{await x.callAPI({table:"contact_record",action:"create",data:{crm_id:k.customer.id,note:Ge.value.note,user_id:1}}),Ge.value.note="",je.value=!1,await Je()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},Ze=async()=>{if(k.customer)try{await x.callAPI({table:"reminder",action:"create",data:{crm_id:k.customer.id,start_time:He.value.start_time,note:He.value.note}}),He.value={start_time:"",note:""},Ie.value=!1,await Je()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}};s(async()=>{Ue.employee&&0!==Ue.employee.length||await Ue.fetchEmployeeList()});const al=a=>a?new Date(a).toLocaleString("zh-TW"):"æœªè¨­å®š";return(a,e)=>{var l,t,s,_,k;return a.visible?(h(),n("div",{key:0,class:"modal-overlay",onClick:Ke},[i("div",{class:"modal-container",onClick:e[23]||(e[23]=u(()=>{},["stop"]))},[i("div",U,[i("div",V,[i("h2",L,o((null==(l=a.customer)?void 0:l.name)||"å®¢æˆ¶è©³æƒ…"),1)]),i("button",{onClick:e[0]||(e[0]=e=>a.$emit("close")),class:"close-button"},e[24]||(e[24]=[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))]),i("div",j,[i("div",I,[i("div",A,[i("div",P,[e[25]||(e[25]=i("h3",null,"åŸºæœ¬è³‡æ–™",-1)),i("button",{onClick:e[1]||(e[1]=a=>Ve.value=!Ve.value),class:d(["edit-btn",{active:Ve.value}])},o(Ve.value?"å–æ¶ˆ":"ç·¨è¼¯"),3)]),i("div",M,[Ve.value?(h(),n("form",{key:0,onSubmit:u(Oe,["prevent"]),class:"edit-form"},[i("div",S,[e[26]||(e[26]=i("label",null,"å®¢æˆ¶åç¨± *",-1)),r(i("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>Ne.value.name=a),type:"text",required:""},null,512),[[m,Ne.value.name]])]),i("div",q,[e[27]||(e[27]=i("label",null,"å…¬å¸çµ±ç·¨",-1)),r(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>Ne.value.company_id=a),type:"text"},null,512),[[m,Ne.value.company_id]])]),i("div",R,[e[28]||(e[28]=i("label",null,"åœ°å€",-1)),r(i("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>Ne.value.address=a),rows:"3"},null,512),[[m,Ne.value.address]])]),i("div",D,[e[30]||(e[30]=i("label",null,"è² è²¬æ¥­å‹™",-1)),r(i("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>Ne.value.sales_id=a)},[e[29]||(e[29]=i("option",{value:""},"è«‹é¸æ“‡è² è²¬æ¥­å‹™",-1)),(h(!0),n(p,null,b(Re.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.name),9,B))),128))],512),[[v,Ne.value.sales_id]])]),i("div",T,[i("button",{type:"button",onClick:e[6]||(e[6]=a=>Ve.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[31]||(e[31]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)):(h(),n("div",$,[i("div",E,[i("div",z,[i("div",F,[e[32]||(e[32]=i("label",null,"å®¢æˆ¶åç¨±",-1)),i("span",null,o(null==(t=a.customer)?void 0:t.name),1)]),i("div",N,[e[33]||(e[33]=i("label",null,"è² è²¬æ¥­å‹™",-1)),i("span",null,o(Fe(null==(s=a.customer)?void 0:s.sales_id)),1)])]),i("div",W,[i("div",G,[e[34]||(e[34]=i("label",null,"å…¬å¸çµ±ç·¨",-1)),i("span",null,o((null==(_=a.customer)?void 0:_.company_id)||"æœªè¨­å®š"),1)])]),i("div",H,[i("div",J,[e[35]||(e[35]=i("label",null,"å…¬å¸åœ°å€",-1)),i("span",null,o((null==(k=a.customer)?void 0:k.address)||"æœªè¨­å®š"),1)])])])]))])]),i("div",K,[i("div",O,[e[36]||(e[36]=i("h3",null,"è¯çµ¡äºº",-1)),i("button",{onClick:e[7]||(e[7]=a=>Le.value=!0),class:"add-btn"},"æ–°å¢")]),i("div",Q,[0===Me.value.length?(h(),n("div",X,e[37]||(e[37]=[i("div",{class:"empty-icon"},"ğŸ‘¥",-1),i("p",null,"å°šæœªæ–°å¢è¯çµ¡äºº",-1)]))):(h(),n("div",Y,[(h(!0),n(p,null,b(Me.value,a=>(h(),n("div",{key:a.id,class:"contact-item-compact"},[i("div",Z,[i("div",aa,[i("span",ea,o(a.name),1),i("span",la,o(a.position||"è·å‹™æœªè¨­å®š"),1)]),i("div",ta,[a.phone?(h(),n("span",sa,o(a.phone),1)):c("",!0),a.mail?(h(),n("span",na,o(a.mail),1)):c("",!0)])]),i("div",ca,[i("button",{onClick:e=>(a=>{Ae.value=a,We.value={name:a.name,position:a.position||"",phone:a.phone||"",mail:a.mail||""}})(a),class:"btn-icon"},"âœï¸",8,ia),i("button",{onClick:e=>(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è¯çµ¡äººå—ï¼Ÿ"))try{await x.callAPI({table:"crm_contact_person",action:"delete",data:{id:a}}),await Je()}catch(e){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-icon btn-danger"},"ğŸ—‘ï¸",8,oa)])]))),128))]))])])]),i("div",da,[i("div",ua,[i("div",ra,[i("div",ma,[e[38]||(e[38]=i("h3",null,"ç›¸é—œå°ˆæ¡ˆ",-1)),i("span",va,o(ze.value.length),1)]),i("div",pa,[0===ze.value.length?(h(),n("div",ba,e[39]||(e[39]=[i("div",{class:"empty-icon-small"},"ğŸ“‹",-1),i("p",null,"å°šç„¡ç›¸é—œå°ˆæ¡ˆ",-1)]))):(h(),n("div",ya,[(h(!0),n(p,null,b(ze.value.slice(0,3),a=>(h(),n("div",{key:a.id,class:"project-item-compact"},[i("div",fa,[i("div",ha,o(a.project_name),1),i("div",_a,[i("span",ka,"NT$ "+o((a.receivable||0).toLocaleString()),1),i("span",wa,o(al(a.created_at)),1)])]),i("button",{onClick:e=>(a=>{window.open(`/project/${a.id}`,"_blank")})(a),class:"btn-view-compact"},"æŸ¥çœ‹",8,Ca)]))),128)),ze.value.length>3?(h(),n("div",ga," é‚„æœ‰ "+o(ze.value.length-3)+" å€‹å°ˆæ¡ˆ... ",1)):c("",!0)]))])]),i("div",xa,[i("div",Ua,[e[40]||(e[40]=i("h3",null,"æé†’è¨­å®š",-1)),i("button",{onClick:e[8]||(e[8]=a=>Ie.value=!0),class:"add-btn"},"æ–°å¢æé†’")]),i("div",Va,[0===qe.value.length?(h(),n("div",La,e[41]||(e[41]=[i("div",{class:"empty-icon-small"},"â°",-1),i("p",null,"å°šç„¡æé†’è¨­å®š",-1)]))):(h(),n("div",ja,[(h(!0),n(p,null,b($e.value.slice(0,3),a=>(h(),n("div",{key:a.id,class:"reminder-item-compact"},[i("div",Ia,[i("div",Aa,"â° "+o(al(a.start_time)),1),i("div",Pa,o(a.note),1)]),i("div",Ma,[i("button",{onClick:e=>(async a=>{try{const e=1;await x.callAPI({table:"reminder",action:"update",data:{id:a,final:e}}),await Je()}catch(e){alert("å®Œæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-complete-compact"},"å®Œæˆ",8,Sa),i("button",{onClick:e=>(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤æé†’å—ï¼Ÿ"))try{await x.callAPI({table:"reminder",action:"delete",data:{id:a}}),await Je()}catch(e){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-icon-small btn-danger"},"ğŸ—‘ï¸",8,qa)])]))),128)),$e.value.length>3||Ee.value.length>0?(h(),n("div",Ra,[$e.value.length>3?(h(),n("span",Da,"é‚„æœ‰ "+o($e.value.length-3)+" å€‹å¾…è¾¦",1)):c("",!0),Ee.value.length>0?(h(),n("span",Ba," â€¢ "+o(Ee.value.length)+" å€‹å·²å®Œæˆ",1)):c("",!0)])):c("",!0)]))])])]),i("div",Ta,[i("div",$a,[i("div",Ea,[e[42]||(e[42]=i("h3",null,"è¯ç¹«ç´€éŒ„",-1)),i("button",{onClick:e[9]||(e[9]=a=>je.value=!0),class:"add-btn"},"æ–°å¢ç´€éŒ„")]),i("div",za,[0===Se.value.length?(h(),n("div",Fa,e[43]||(e[43]=[i("div",{class:"empty-icon"},"ğŸ“",-1),i("p",null,"å°šç„¡è¯ç¹«ç´€éŒ„",-1)]))):(h(),n("div",Na,[(h(!0),n(p,null,b(Be.value,a=>(h(),n("div",{key:a.id,class:"timeline-item"},[e[44]||(e[44]=i("div",{class:"timeline-marker"},null,-1)),i("div",Wa,[i("div",Ga,[i("span",Ha,o(al(a.created_at)),1),i("span",Ja,o(a.user_name||"ç³»çµ±"),1)]),i("div",Ka,o(a.note),1)])]))),128)),Te.value.length>0?(h(),n("div",Oa,[i("button",{onClick:e[10]||(e[10]=a=>Pe.value=!Pe.value),class:"expand-btn"},[(h(),n("svg",Qa,[i("path",{d:Pe.value?"M18 15l-6-6-6 6":"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2"},null,8,Xa)])),y(" "+o(Pe.value?"æ”¶èµ·":`é¡¯ç¤ºæ›´å¤š (${Te.value.length} ç­†)`),1)]),r(i("div",Ya,[(h(!0),n(p,null,b(Te.value,a=>(h(),n("div",{key:a.id,class:"timeline-item"},[e[45]||(e[45]=i("div",{class:"timeline-marker"},null,-1)),i("div",Za,[i("div",ae,[i("span",ee,o(al(a.created_at)),1),i("span",le,o(a.user_name||"ç³»çµ±"),1)]),i("div",te,o(a.note),1)])]))),128))],512),[[f,Pe.value]])])):c("",!0)]))])])])])]),Le.value||Ae.value?(h(),n("div",se,[i("div",ne,[i("div",ce,[i("h3",null,o(Ae.value?"ç·¨è¼¯è¯çµ¡äºº":"æ–°å¢è¯çµ¡äºº"),1),i("button",{onClick:Qe,class:"close-button"},"Ã—")]),i("form",{onSubmit:u(Xe,["prevent"]),class:"sub-modal-body"},[i("div",ie,[i("div",oe,[e[46]||(e[46]=i("label",null,"å§“å *",-1)),r(i("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>We.value.name=a),type:"text",required:""},null,512),[[m,We.value.name]])]),i("div",de,[e[47]||(e[47]=i("label",null,"è·å‹™",-1)),r(i("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>We.value.position=a),type:"text"},null,512),[[m,We.value.position]])])]),i("div",ue,[i("div",re,[e[48]||(e[48]=i("label",null,"é›»è©±",-1)),r(i("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>We.value.phone=a),type:"tel"},null,512),[[m,We.value.phone]])]),i("div",me,[e[49]||(e[49]=i("label",null,"ä¿¡ç®±",-1)),r(i("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>We.value.mail=a),type:"email"},null,512),[[m,We.value.mail]])])]),i("div",{class:"form-actions"},[i("button",{type:"button",onClick:Qe,class:"btn-secondary"},"å–æ¶ˆ"),e[50]||(e[50]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0),je.value?(h(),n("div",ve,[i("div",pe,[i("div",be,[e[51]||(e[51]=i("h3",null,"æ–°å¢è¯ç¹«ç´€éŒ„",-1)),i("button",{onClick:e[15]||(e[15]=a=>je.value=!1),class:"close-button"},"Ã—")]),i("form",{onSubmit:u(Ye,["prevent"]),class:"sub-modal-body"},[i("div",ye,[e[52]||(e[52]=i("label",null,"è¯ç¹«å…§å®¹ *",-1)),r(i("textarea",{"onUpdate:modelValue":e[16]||(e[16]=a=>Ge.value.note=a),rows:"4",required:"",placeholder:"è«‹è¼¸å…¥è¯ç¹«å…§å®¹..."},null,512),[[m,Ge.value.note]])]),i("div",fe,[i("button",{type:"button",onClick:e[17]||(e[17]=a=>je.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[53]||(e[53]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0),Ie.value?(h(),n("div",he,[i("div",_e,[i("div",ke,[e[54]||(e[54]=i("h3",null,"æ–°å¢æé†’",-1)),i("button",{onClick:e[18]||(e[18]=a=>Ie.value=!1),class:"close-button"},"Ã—")]),i("form",{onSubmit:u(Ze,["prevent"]),class:"sub-modal-body"},[i("div",we,[e[55]||(e[55]=i("label",null,"é–‹å§‹æ™‚é–“ *",-1)),r(i("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>He.value.start_time=a),type:"datetime-local",required:""},null,512),[[m,He.value.start_time]])]),i("div",Ce,[e[56]||(e[56]=i("label",null,"çµæŸæ™‚é–“",-1)),r(i("input",{"onUpdate:modelValue":e[20]||(e[20]=a=>He.value.end_time=a),type:"datetime-local"},null,512),[[m,He.value.end_time]])]),i("div",ge,[e[57]||(e[57]=i("label",null,"æé†’å…§å®¹ *",-1)),r(i("textarea",{"onUpdate:modelValue":e[21]||(e[21]=a=>He.value.note=a),rows:"3",required:"",placeholder:"è«‹è¼¸å…¥æé†’å…§å®¹..."},null,512),[[m,He.value.note]])]),i("div",xe,[i("button",{type:"button",onClick:e[22]||(e[22]=a=>Ie.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[58]||(e[58]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0)])])):c("",!0)}}}),[["__scopeId","data-v-58c52f35"]]),Ve={class:"crm-list"},Le={class:"page-header"},je={class:"filters"},Ie={key:0,class:"loading"},Ae={key:1,class:"empty-state"},Pe={key:2,class:"crm-grid"},Me=["onClick"],Se={class:"crm-header"},qe={class:"crm-sales"},Re={class:"crm-company"},De={class:"crm-address"},Be={class:"modal-header"},Te={class:"form-group"},$e={class:"form-group"},Ee={class:"form-group"},ze={class:"form-group"},Fe=["value"],Ne={class:"modal-actions"},We=["disabled"],Ge=x(a({__name:"CRMListView",setup(a){const t=g(),d=C(),{crmList:y,employee:f}=_(t),{loading:x}=_(d),U=l(()=>f.value||[]),V=e(""),L=e("name"),j=e(!1),I=e(!1),A=e(!1),P=e(!1),M=e(null),S=e(null),q=e({name:"",company_id:"",address:"",sales_id:null}),R=l(()=>{let a=y.value.filter(a=>{var e;return a.name.toLowerCase().includes(V.value.toLowerCase())||(null==(e=a.company_id)?void 0:e.toLowerCase().includes(V.value.toLowerCase()))||""});return a.sort((a,e)=>"name"===L.value?a.name.localeCompare(e.name):"created_at"===L.value?new Date(e.created_at).getTime()-new Date(a.created_at).getTime():"company_id"===L.value?(a.company_id||"").localeCompare(e.company_id||""):0),a}),D=()=>{j.value=!1,I.value=!1,q.value={name:"",company_id:"",address:"",sales_id:null},M.value=null},B=async()=>{P.value=!0;try{j.value?await t.createCRM(q.value):M.value&&await t.updateCRM(M.value.id,q.value),D()}catch(a){}finally{P.value=!1}},T=()=>{A.value=!1,S.value=null},$=a=>{if(!a)return"æœªè¨­å®š";const e=U.value.find(e=>e.id===a);return e?e.name:"æœªè¨­å®š"},E=async()=>{await t.fetchCRMList()};return s(async()=>{await Promise.all([t.fetchCRMList(),t.fetchEmployeeList()])}),(a,e)=>(h(),n("div",Ve,[i("div",Le,[e[8]||(e[8]=i("h1",null,"å®¢æˆ¶ç®¡ç†",-1)),i("button",{onClick:e[0]||(e[0]=a=>j.value=!0),class:"btn btn-primary"}," æ–°å¢å®¢æˆ¶ ")]),i("div",je,[r(i("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),type:"text",placeholder:"æœå°‹å®¢æˆ¶åç¨±æˆ–å…¬å¸...",class:"search-input"},null,512),[[m,V.value]]),r(i("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>L.value=a),class:"sort-select"},e[9]||(e[9]=[i("option",{value:"name"},"ä¾åç¨±æ’åº",-1),i("option",{value:"created_at"},"ä¾å»ºç«‹æ™‚é–“æ’åº",-1),i("option",{value:"company_id"},"ä¾å…¬å¸æ’åº",-1)]),512),[[v,L.value]])]),w(x)?(h(),n("div",Ie,"è¼‰å…¥ä¸­...")):0===R.value.length?(h(),n("div",Ae,e[10]||(e[10]=[i("div",{class:"empty-icon"},"ğŸ‘¥",-1),i("p",null,"å°šç„¡å®¢æˆ¶è³‡æ–™",-1)]))):(h(),n("div",Pe,[(h(!0),n(p,null,b(R.value,a=>(h(),n("div",{key:a.id,class:"crm-card",onClick:e=>(a=>{S.value=a,A.value=!0})(a)},[i("div",Se,[i("h3",null,o(a.name),1),i("span",qe,o($(a.sales_id)),1)]),i("p",Re,o(a.company_id),1),i("p",De,o(a.address),1)],8,Me))),128))])),j.value||I.value?(h(),n("div",{key:3,class:"modal-overlay",onClick:D},[i("div",{class:"modal",onClick:e[7]||(e[7]=u(()=>{},["stop"]))},[i("div",Be,[i("h2",null,o(j.value?"æ–°å¢å®¢æˆ¶":"ç·¨è¼¯å®¢æˆ¶"),1),i("button",{onClick:D,class:"close-btn"},"Ã—")]),i("form",{onSubmit:u(B,["prevent"]),class:"modal-body"},[i("div",Te,[e[11]||(e[11]=i("label",null,"å®¢æˆ¶åç¨± *",-1)),r(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>q.value.name=a),type:"text",required:""},null,512),[[m,q.value.name]])]),i("div",$e,[e[12]||(e[12]=i("label",null,"å…¬å¸åç¨±",-1)),r(i("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>q.value.company_id=a),type:"text"},null,512),[[m,q.value.company_id]])]),i("div",Ee,[e[13]||(e[13]=i("label",null,"åœ°å€",-1)),r(i("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>q.value.address=a),rows:"3"},null,512),[[m,q.value.address]])]),i("div",ze,[e[15]||(e[15]=i("label",null,"è² è²¬æ¥­å‹™",-1)),r(i("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>q.value.sales_id=a)},[e[14]||(e[14]=i("option",{value:""},"è«‹é¸æ“‡è² è²¬æ¥­å‹™",-1)),(h(!0),n(p,null,b(U.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.name),9,Fe))),128))],512),[[v,q.value.sales_id]])]),i("div",Ne,[i("button",{type:"button",onClick:D,class:"btn btn-outline"}," å–æ¶ˆ "),i("button",{type:"submit",class:"btn btn-primary",disabled:P.value},o(P.value?"è™•ç†ä¸­...":j.value?"æ–°å¢":"æ›´æ–°"),9,We)])],32)])])):c("",!0),k(Ue,{visible:A.value,customer:S.value,onClose:T,onUpdated:E},null,8,["visible","customer"])]))}}),[["__scopeId","data-v-9f115176"]]);export{Ge as default};
