import{a,r as e,c as l,B as t,j as s,e as n,i as c,f as i,t as o,n as d,y as u,z as r,A as m,C as v,F as p,g as y,D as b,E as f,o as h,v as _,k,l as w}from"./vue-DD7UfKtI.js";import{b as C,a as g,_ as U}from"./index-BH4LE6s5.js";import"./vendor-C7jwa7K6.js";const V={class:"modal-header"},x={class:"header-info"},j={class:"customer-name"},L={class:"modal-content"},I={class:"sidebar"},A={class:"card"},P={class:"card-header"},M={class:"card-content"},S={class:"form-field"},q={class:"form-field"},R={class:"form-field"},D={class:"form-field"},B=["value"],T={class:"form-actions"},$={key:1,class:"info-display-compact"},E={class:"info-grid-pairs"},z={class:"info-pair"},F={class:"info-item-compact"},N={class:"info-item-compact"},W={class:"info-pair"},G={class:"info-item-compact"},H={class:"info-pair"},J={class:"info-item-compact full-width"},K={class:"card"},O={class:"card-header"},Q={class:"card-content"},X={key:0,class:"empty-state"},Y={key:1,class:"contact-list-compact"},Z={class:"contact-info-compact"},aa={class:"contact-main"},ea={class:"contact-name"},la={class:"contact-position"},ta={class:"contact-details-compact"},sa={key:0,class:"contact-phone"},na={key:1,class:"contact-email"},ca={class:"contact-actions-compact"},ia=["onClick"],oa=["onClick"],da={class:"main-content"},ua={class:"first-row"},ra={class:"card half-width-card"},ma={class:"card-header"},va={class:"count-badge"},pa={class:"card-content compact-content"},ya={key:0,class:"empty-state-compact"},ba={key:1,class:"project-list-compact"},fa={class:"project-content-compact"},ha={class:"project-name-compact"},_a={class:"project-meta-compact"},ka={class:"project-amount-compact"},wa={class:"project-date-compact"},Ca=["onClick"],ga={key:0,class:"show-more-compact"},Ua={class:"card half-width-card"},Va={class:"card-header"},xa={class:"card-content compact-content"},ja={key:0,class:"empty-state-compact"},La={key:1,class:"reminder-list-compact"},Ia={class:"reminder-main-compact"},Aa={class:"reminder-time-compact"},Pa={class:"reminder-text-compact"},Ma={class:"reminder-actions-compact"},Sa=["onClick"],qa=["onClick"],Ra={key:0,class:"show-more-compact"},Da={key:0},Ba={key:1},Ta={class:"second-row"},$a={class:"card full-width-card"},Ea={class:"card-header"},za={class:"card-content"},Fa={key:0,class:"empty-state"},Na={key:1,class:"timeline"},Wa={class:"timeline-content"},Ga={class:"timeline-header"},Ha={class:"timeline-date"},Ja={class:"timeline-user"},Ka={class:"timeline-text"},Oa={key:0,class:"timeline-more"},Qa={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},Xa=["d"],Ya={class:"timeline-collapsed"},Za={class:"timeline-content"},ae={class:"timeline-header"},ee={class:"timeline-date"},le={class:"timeline-user"},te={class:"timeline-text"},se={key:0,class:"sub-modal"},ne={class:"sub-modal-content"},ce={class:"sub-modal-header"},ie={class:"form-row"},oe={class:"form-field"},de={class:"form-field"},ue={class:"form-row"},re={class:"form-field"},me={class:"form-field"},ve={key:1,class:"sub-modal"},pe={class:"sub-modal-content"},ye={class:"sub-modal-header"},be={class:"form-field"},fe=["value"],he={class:"form-field"},_e=["value"],ke={class:"form-field"},we={class:"form-actions"},Ce={key:2,class:"sub-modal"},ge={class:"sub-modal-content"},Ue={class:"sub-modal-header"},Ve={class:"form-field"},xe={class:"form-field"},je={class:"form-field"},Le={class:"form-actions"},Ie=U(a({__name:"CRMDetailModal",props:{visible:{type:Boolean},customer:{}},emits:["close","updated"],setup(a,{emit:_}){const k=a,w=_,U=C(),Ie=g(),Ae=e(!1),Pe=e(!1),Me=e(!1),Se=e(!1),qe=e(null),Re=e(!1);e(!1);const De=e([]),Be=e([]),Te=e([]),$e=l(()=>Ie.employee||[]);l(()=>Ie.employee||[]);const Ee=l(()=>Ie.projectList||[]),ze=l(()=>Be.value.slice(0,3)),Fe=l(()=>Be.value.slice(3)),Ne=l(()=>Te.value.filter(a=>!a.final)),We=l(()=>Te.value.filter(a=>a.final)),Ge=l(()=>{var a;return(null==(a=k.customer)?void 0:a.id)?Ee.value.filter(a=>a.crm_id===k.customer.id):[]}),He=l(()=>(Ie.tags||[]).filter(a=>"project_state"===a.type&&!a.deleted_at)),Je=a=>{if(!a)return"æœªè¨­å®š";const e=$e.value.find(e=>e.id===a);return e?e.name:"æœªè¨­å®š"},Ke=e({name:"",company_id:"",address:"",sales_id:null}),Oe=e({name:"",position:"",phone:"",mail:""}),Qe=e({note:"",project_id:null,state:null}),Xe=e({start_time:"",end_time:"",note:""});t(()=>k.customer,async a=>{a&&(Ke.value={name:a.name,company_id:a.company_id||"",address:a.address||"",sales_id:a.sales_id||null},await Ye())},{immediate:!0});const Ye=async()=>{if(k.customer)try{const a=await U.callAPI({table:"crm_contact_person",action:"read",filters:{crm_id:k.customer.id}});De.value=a||[];const e=await U.callAPI({table:"contact_record",action:"read",filters:{crm_id:k.customer.id}});Be.value=e||[];const l=await U.callAPI({table:"reminder",action:"read",filters:{crm_id:k.customer.id}});Te.value=l||[]}catch(a){}},Ze=()=>{w("close")},al=async()=>{if(k.customer)try{await U.callAPI({table:"crm",action:"update",data:{id:k.customer.id,...Ke.value}}),Ae.value=!1,w("updated")}catch(a){alert("æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},el=()=>{Pe.value=!1,qe.value=null,Oe.value={name:"",position:"",phone:"",mail:""}},ll=async()=>{if(k.customer)try{qe.value?await U.callAPI({table:"crm_contact_person",action:"update",data:{id:qe.value.id,...Oe.value}}):await U.callAPI({table:"crm_contact_person",action:"create",data:{crm_id:k.customer.id,...Oe.value}}),await Ye(),el()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},tl=async()=>{if(k.customer)try{await U.callAPI({table:"contact_record",action:"create",data:{crm_id:k.customer.id,note:Qe.value.note,user_id:1}}),Qe.value.note="",Me.value=!1,await Ye()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}},sl=async()=>{if(k.customer)try{await U.callAPI({table:"reminder",action:"create",data:{crm_id:k.customer.id,start_time:Xe.value.start_time,note:Xe.value.note}}),Xe.value={start_time:"",note:""},Se.value=!1,await Ye()}catch(a){alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}};s(async()=>{Ie.employee&&0!==Ie.employee.length||await Ie.fetchEmployeeList()});const nl=a=>a?new Date(a).toLocaleString("zh-TW"):"æœªè¨­å®š";return(a,e)=>{var l,t,s,_,k;return a.visible?(h(),n("div",{key:0,class:"modal-overlay",onClick:Ze},[i("div",{class:"modal-container",onClick:e[25]||(e[25]=u(()=>{},["stop"]))},[i("div",V,[i("div",x,[i("h2",j,o((null==(l=a.customer)?void 0:l.name)||"å®¢æˆ¶è©³æƒ…"),1)]),i("button",{onClick:e[0]||(e[0]=e=>a.$emit("close")),class:"close-button"},e[26]||(e[26]=[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))]),i("div",L,[i("div",I,[i("div",A,[i("div",P,[e[27]||(e[27]=i("h3",null,"åŸºæœ¬è³‡æ–™",-1)),i("button",{onClick:e[1]||(e[1]=a=>Ae.value=!Ae.value),class:d(["edit-btn",{active:Ae.value}])},o(Ae.value?"å–æ¶ˆ":"ç·¨è¼¯"),3)]),i("div",M,[Ae.value?(h(),n("form",{key:0,onSubmit:u(al,["prevent"]),class:"edit-form"},[i("div",S,[e[28]||(e[28]=i("label",null,"å®¢æˆ¶åç¨± *",-1)),r(i("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>Ke.value.name=a),type:"text",required:""},null,512),[[m,Ke.value.name]])]),i("div",q,[e[29]||(e[29]=i("label",null,"å…¬å¸çµ±ç·¨",-1)),r(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>Ke.value.company_id=a),type:"text"},null,512),[[m,Ke.value.company_id]])]),i("div",R,[e[30]||(e[30]=i("label",null,"åœ°å€",-1)),r(i("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>Ke.value.address=a),rows:"3"},null,512),[[m,Ke.value.address]])]),i("div",D,[e[32]||(e[32]=i("label",null,"è² è²¬æ¥­å‹™",-1)),r(i("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>Ke.value.sales_id=a)},[e[31]||(e[31]=i("option",{value:""},"è«‹é¸æ“‡è² è²¬æ¥­å‹™",-1)),(h(!0),n(p,null,y($e.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.name),9,B))),128))],512),[[v,Ke.value.sales_id]])]),i("div",T,[i("button",{type:"button",onClick:e[6]||(e[6]=a=>Ae.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[33]||(e[33]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)):(h(),n("div",$,[i("div",E,[i("div",z,[i("div",F,[e[34]||(e[34]=i("label",null,"å®¢æˆ¶åç¨±",-1)),i("span",null,o(null==(t=a.customer)?void 0:t.name),1)]),i("div",N,[e[35]||(e[35]=i("label",null,"è² è²¬æ¥­å‹™",-1)),i("span",null,o(Je(null==(s=a.customer)?void 0:s.sales_id)),1)])]),i("div",W,[i("div",G,[e[36]||(e[36]=i("label",null,"å…¬å¸çµ±ç·¨",-1)),i("span",null,o((null==(_=a.customer)?void 0:_.company_id)||"æœªè¨­å®š"),1)])]),i("div",H,[i("div",J,[e[37]||(e[37]=i("label",null,"å…¬å¸åœ°å€",-1)),i("span",null,o((null==(k=a.customer)?void 0:k.address)||"æœªè¨­å®š"),1)])])])]))])]),i("div",K,[i("div",O,[e[38]||(e[38]=i("h3",null,"è¯çµ¡äºº",-1)),i("button",{onClick:e[7]||(e[7]=a=>Pe.value=!0),class:"add-btn"},"æ–°å¢")]),i("div",Q,[0===De.value.length?(h(),n("div",X,e[39]||(e[39]=[i("div",{class:"empty-icon"},"ğŸ‘¥",-1),i("p",null,"å°šæœªæ–°å¢è¯çµ¡äºº",-1)]))):(h(),n("div",Y,[(h(!0),n(p,null,y(De.value,a=>(h(),n("div",{key:a.id,class:"contact-item-compact"},[i("div",Z,[i("div",aa,[i("span",ea,o(a.name),1),i("span",la,o(a.position||"è·å‹™æœªè¨­å®š"),1)]),i("div",ta,[a.phone?(h(),n("span",sa,o(a.phone),1)):c("",!0),a.mail?(h(),n("span",na,o(a.mail),1)):c("",!0)])]),i("div",ca,[i("button",{onClick:e=>(a=>{qe.value=a,Oe.value={name:a.name,position:a.position||"",phone:a.phone||"",mail:a.mail||""}})(a),class:"btn-icon"},"âœï¸",8,ia),i("button",{onClick:e=>(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è¯çµ¡äººå—ï¼Ÿ"))try{await U.callAPI({table:"crm_contact_person",action:"delete",data:{id:a}}),await Ye()}catch(e){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-icon btn-danger"},"ğŸ—‘ï¸",8,oa)])]))),128))]))])])]),i("div",da,[i("div",ua,[i("div",ra,[i("div",ma,[e[40]||(e[40]=i("h3",null,"ç›¸é—œå°ˆæ¡ˆ",-1)),i("span",va,o(Ge.value.length),1)]),i("div",pa,[0===Ge.value.length?(h(),n("div",ya,e[41]||(e[41]=[i("div",{class:"empty-icon-small"},"ğŸ“‹",-1),i("p",null,"å°šç„¡ç›¸é—œå°ˆæ¡ˆ",-1)]))):(h(),n("div",ba,[(h(!0),n(p,null,y(Ge.value.slice(0,3),a=>(h(),n("div",{key:a.id,class:"project-item-compact"},[i("div",fa,[i("div",ha,o(a.project_name),1),i("div",_a,[i("span",ka,"NT$ "+o((a.receivable||0).toLocaleString()),1),i("span",wa,o(nl(a.created_at)),1)])]),i("button",{onClick:e=>(a=>{window.open(`/project/${a.id}`,"_blank")})(a),class:"btn-view-compact"},"æŸ¥çœ‹",8,Ca)]))),128)),Ge.value.length>3?(h(),n("div",ga," é‚„æœ‰ "+o(Ge.value.length-3)+" å€‹å°ˆæ¡ˆ... ",1)):c("",!0)]))])]),i("div",Ua,[i("div",Va,[e[42]||(e[42]=i("h3",null,"æé†’è¨­å®š",-1)),i("button",{onClick:e[8]||(e[8]=a=>Se.value=!0),class:"add-btn"},"æ–°å¢æé†’")]),i("div",xa,[0===Te.value.length?(h(),n("div",ja,e[43]||(e[43]=[i("div",{class:"empty-icon-small"},"â°",-1),i("p",null,"å°šç„¡æé†’è¨­å®š",-1)]))):(h(),n("div",La,[(h(!0),n(p,null,y(Ne.value.slice(0,3),a=>(h(),n("div",{key:a.id,class:"reminder-item-compact"},[i("div",Ia,[i("div",Aa,"â° "+o(nl(a.start_time)),1),i("div",Pa,o(a.note),1)]),i("div",Ma,[i("button",{onClick:e=>(async a=>{try{const e=1;await U.callAPI({table:"reminder",action:"update",data:{id:a,final:e}}),await Ye()}catch(e){alert("å®Œæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-complete-compact"},"å®Œæˆ",8,Sa),i("button",{onClick:e=>(async a=>{if(confirm("ç¢ºå®šè¦åˆªé™¤æ­¤æé†’å—ï¼Ÿ"))try{await U.callAPI({table:"reminder",action:"delete",data:{id:a}}),await Ye()}catch(e){alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}})(a.id),class:"btn-icon-small btn-danger"},"ğŸ—‘ï¸",8,qa)])]))),128)),Ne.value.length>3||We.value.length>0?(h(),n("div",Ra,[Ne.value.length>3?(h(),n("span",Da,"é‚„æœ‰ "+o(Ne.value.length-3)+" å€‹å¾…è¾¦",1)):c("",!0),We.value.length>0?(h(),n("span",Ba," â€¢ "+o(We.value.length)+" å€‹å·²å®Œæˆ",1)):c("",!0)])):c("",!0)]))])])]),i("div",Ta,[i("div",$a,[i("div",Ea,[e[44]||(e[44]=i("h3",null,"è¯ç¹«ç´€éŒ„",-1)),i("button",{onClick:e[9]||(e[9]=a=>Me.value=!0),class:"add-btn"},"æ–°å¢ç´€éŒ„")]),i("div",za,[0===Be.value.length?(h(),n("div",Fa,e[45]||(e[45]=[i("div",{class:"empty-icon"},"ğŸ“",-1),i("p",null,"å°šç„¡è¯ç¹«ç´€éŒ„",-1)]))):(h(),n("div",Na,[(h(!0),n(p,null,y(ze.value,a=>(h(),n("div",{key:a.id,class:"timeline-item"},[e[46]||(e[46]=i("div",{class:"timeline-marker"},null,-1)),i("div",Wa,[i("div",Ga,[i("span",Ha,o(nl(a.created_at)),1),i("span",Ja,o(a.user_name||"ç³»çµ±"),1)]),i("div",Ka,o(a.note),1)])]))),128)),Fe.value.length>0?(h(),n("div",Oa,[i("button",{onClick:e[10]||(e[10]=a=>Re.value=!Re.value),class:"expand-btn"},[(h(),n("svg",Qa,[i("path",{d:Re.value?"M18 15l-6-6-6 6":"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2"},null,8,Xa)])),b(" "+o(Re.value?"æ”¶èµ·":`é¡¯ç¤ºæ›´å¤š (${Fe.value.length} ç­†)`),1)]),r(i("div",Ya,[(h(!0),n(p,null,y(Fe.value,a=>(h(),n("div",{key:a.id,class:"timeline-item"},[e[47]||(e[47]=i("div",{class:"timeline-marker"},null,-1)),i("div",Za,[i("div",ae,[i("span",ee,o(nl(a.created_at)),1),i("span",le,o(a.user_name||"ç³»çµ±"),1)]),i("div",te,o(a.note),1)])]))),128))],512),[[f,Re.value]])])):c("",!0)]))])])])])]),Pe.value||qe.value?(h(),n("div",se,[i("div",ne,[i("div",ce,[i("h3",null,o(qe.value?"ç·¨è¼¯è¯çµ¡äºº":"æ–°å¢è¯çµ¡äºº"),1),i("button",{onClick:el,class:"close-button"},"Ã—")]),i("form",{onSubmit:u(ll,["prevent"]),class:"sub-modal-body"},[i("div",ie,[i("div",oe,[e[48]||(e[48]=i("label",null,"å§“å *",-1)),r(i("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>Oe.value.name=a),type:"text",required:""},null,512),[[m,Oe.value.name]])]),i("div",de,[e[49]||(e[49]=i("label",null,"è·å‹™",-1)),r(i("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>Oe.value.position=a),type:"text"},null,512),[[m,Oe.value.position]])])]),i("div",ue,[i("div",re,[e[50]||(e[50]=i("label",null,"é›»è©±",-1)),r(i("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>Oe.value.phone=a),type:"tel"},null,512),[[m,Oe.value.phone]])]),i("div",me,[e[51]||(e[51]=i("label",null,"ä¿¡ç®±",-1)),r(i("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>Oe.value.mail=a),type:"email"},null,512),[[m,Oe.value.mail]])])]),i("div",{class:"form-actions"},[i("button",{type:"button",onClick:el,class:"btn-secondary"},"å–æ¶ˆ"),e[52]||(e[52]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0),Me.value?(h(),n("div",ve,[i("div",pe,[i("div",ye,[e[53]||(e[53]=i("h3",null,"æ–°å¢è¯ç¹«ç´€éŒ„",-1)),i("button",{onClick:e[15]||(e[15]=a=>Me.value=!1),class:"close-button"},"Ã—")]),i("form",{onSubmit:u(tl,["prevent"]),class:"sub-modal-body"},[i("div",be,[e[55]||(e[55]=i("label",null,"é—œè¯å°ˆæ¡ˆ",-1)),r(i("select",{"onUpdate:modelValue":e[16]||(e[16]=a=>Qe.value.project_id=a)},[e[54]||(e[54]=i("option",{value:""},"è«‹é¸æ“‡å°ˆæ¡ˆï¼ˆå¯é¸ï¼‰",-1)),(h(!0),n(p,null,y(Ge.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.project_name),9,fe))),128))],512),[[v,Qe.value.project_id]])]),i("div",he,[e[57]||(e[57]=i("label",null,"å°ˆæ¡ˆç‹€æ…‹",-1)),r(i("select",{"onUpdate:modelValue":e[17]||(e[17]=a=>Qe.value.state=a)},[e[56]||(e[56]=i("option",{value:""},"è«‹é¸æ“‡ç‹€æ…‹ï¼ˆå¯é¸ï¼‰",-1)),(h(!0),n(p,null,y(He.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.name),9,_e))),128))],512),[[v,Qe.value.state]])]),i("div",ke,[e[58]||(e[58]=i("label",null,"è¯ç¹«å…§å®¹ *",-1)),r(i("textarea",{"onUpdate:modelValue":e[18]||(e[18]=a=>Qe.value.note=a),rows:"4",required:"",placeholder:"è«‹è¼¸å…¥è¯ç¹«å…§å®¹..."},null,512),[[m,Qe.value.note]])]),i("div",we,[i("button",{type:"button",onClick:e[19]||(e[19]=a=>Me.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[59]||(e[59]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0),Se.value?(h(),n("div",Ce,[i("div",ge,[i("div",Ue,[e[60]||(e[60]=i("h3",null,"æ–°å¢æé†’",-1)),i("button",{onClick:e[20]||(e[20]=a=>Se.value=!1),class:"close-button"},"Ã—")]),i("form",{onSubmit:u(sl,["prevent"]),class:"sub-modal-body"},[i("div",Ve,[e[61]||(e[61]=i("label",null,"é–‹å§‹æ™‚é–“ *",-1)),r(i("input",{"onUpdate:modelValue":e[21]||(e[21]=a=>Xe.value.start_time=a),type:"datetime-local",required:""},null,512),[[m,Xe.value.start_time]])]),i("div",xe,[e[62]||(e[62]=i("label",null,"çµæŸæ™‚é–“",-1)),r(i("input",{"onUpdate:modelValue":e[22]||(e[22]=a=>Xe.value.end_time=a),type:"datetime-local"},null,512),[[m,Xe.value.end_time]])]),i("div",je,[e[63]||(e[63]=i("label",null,"æé†’å…§å®¹ *",-1)),r(i("textarea",{"onUpdate:modelValue":e[23]||(e[23]=a=>Xe.value.note=a),rows:"3",required:"",placeholder:"è«‹è¼¸å…¥æé†’å…§å®¹..."},null,512),[[m,Xe.value.note]])]),i("div",Le,[i("button",{type:"button",onClick:e[24]||(e[24]=a=>Se.value=!1),class:"btn-secondary"},"å–æ¶ˆ"),e[64]||(e[64]=i("button",{type:"submit",class:"btn-primary"},"å„²å­˜",-1))])],32)])])):c("",!0)])])):c("",!0)}}}),[["__scopeId","data-v-cdcae8e6"]]),Ae={class:"crm-list"},Pe={class:"page-header"},Me={class:"filters"},Se={key:0,class:"loading"},qe={key:1,class:"empty-state"},Re={key:2,class:"crm-grid"},De=["onClick"],Be={class:"crm-header"},Te={class:"crm-sales"},$e={class:"crm-company"},Ee={class:"crm-address"},ze={class:"modal-header"},Fe={class:"form-group"},Ne={class:"form-group"},We={class:"form-group"},Ge={class:"form-group"},He=["value"],Je={class:"modal-actions"},Ke=["disabled"],Oe=U(a({__name:"CRMListView",setup(a){const t=g(),d=C(),{crmList:b,employee:f}=_(t),{loading:U}=_(d),V=l(()=>f.value||[]),x=e(""),j=e("name"),L=e(!1),I=e(!1),A=e(!1),P=e(!1),M=e(null),S=e(null),q=e({name:"",company_id:"",address:"",sales_id:null}),R=l(()=>{let a=b.value.filter(a=>{var e;return a.name.toLowerCase().includes(x.value.toLowerCase())||(null==(e=a.company_id)?void 0:e.toLowerCase().includes(x.value.toLowerCase()))||""});return a.sort((a,e)=>"name"===j.value?a.name.localeCompare(e.name):"created_at"===j.value?new Date(e.created_at).getTime()-new Date(a.created_at).getTime():"company_id"===j.value?(a.company_id||"").localeCompare(e.company_id||""):0),a}),D=()=>{L.value=!1,I.value=!1,q.value={name:"",company_id:"",address:"",sales_id:null},M.value=null},B=async()=>{P.value=!0;try{L.value?await t.createCRM(q.value):M.value&&await t.updateCRM(M.value.id,q.value),D()}catch(a){}finally{P.value=!1}},T=()=>{A.value=!1,S.value=null},$=a=>{if(!a)return"æœªè¨­å®š";const e=V.value.find(e=>e.id===a);return e?e.name:"æœªè¨­å®š"},E=async()=>{await t.fetchCRMList()};return s(async()=>{await Promise.all([t.fetchCRMList(),t.fetchEmployeeList()])}),(a,e)=>(h(),n("div",Ae,[i("div",Pe,[e[8]||(e[8]=i("h1",null,"å®¢æˆ¶ç®¡ç†",-1)),i("button",{onClick:e[0]||(e[0]=a=>L.value=!0),class:"btn btn-primary"}," æ–°å¢å®¢æˆ¶ ")]),i("div",Me,[r(i("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),type:"text",placeholder:"æœå°‹å®¢æˆ¶åç¨±æˆ–å…¬å¸...",class:"search-input"},null,512),[[m,x.value]]),r(i("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>j.value=a),class:"sort-select"},e[9]||(e[9]=[i("option",{value:"name"},"ä¾åç¨±æ’åº",-1),i("option",{value:"created_at"},"ä¾å»ºç«‹æ™‚é–“æ’åº",-1),i("option",{value:"company_id"},"ä¾å…¬å¸æ’åº",-1)]),512),[[v,j.value]])]),w(U)?(h(),n("div",Se,"è¼‰å…¥ä¸­...")):0===R.value.length?(h(),n("div",qe,e[10]||(e[10]=[i("div",{class:"empty-icon"},"ğŸ‘¥",-1),i("p",null,"å°šç„¡å®¢æˆ¶è³‡æ–™",-1)]))):(h(),n("div",Re,[(h(!0),n(p,null,y(R.value,a=>(h(),n("div",{key:a.id,class:"crm-card",onClick:e=>(a=>{S.value=a,A.value=!0})(a)},[i("div",Be,[i("h3",null,o(a.name),1),i("span",Te,o($(a.sales_id)),1)]),i("p",$e,o(a.company_id),1),i("p",Ee,o(a.address),1)],8,De))),128))])),L.value||I.value?(h(),n("div",{key:3,class:"modal-overlay",onClick:D},[i("div",{class:"modal",onClick:e[7]||(e[7]=u(()=>{},["stop"]))},[i("div",ze,[i("h2",null,o(L.value?"æ–°å¢å®¢æˆ¶":"ç·¨è¼¯å®¢æˆ¶"),1),i("button",{onClick:D,class:"close-btn"},"Ã—")]),i("form",{onSubmit:u(B,["prevent"]),class:"modal-body"},[i("div",Fe,[e[11]||(e[11]=i("label",null,"å®¢æˆ¶åç¨± *",-1)),r(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>q.value.name=a),type:"text",required:""},null,512),[[m,q.value.name]])]),i("div",Ne,[e[12]||(e[12]=i("label",null,"å…¬å¸åç¨±",-1)),r(i("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>q.value.company_id=a),type:"text"},null,512),[[m,q.value.company_id]])]),i("div",We,[e[13]||(e[13]=i("label",null,"åœ°å€",-1)),r(i("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>q.value.address=a),rows:"3"},null,512),[[m,q.value.address]])]),i("div",Ge,[e[15]||(e[15]=i("label",null,"è² è²¬æ¥­å‹™",-1)),r(i("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>q.value.sales_id=a)},[e[14]||(e[14]=i("option",{value:""},"è«‹é¸æ“‡è² è²¬æ¥­å‹™",-1)),(h(!0),n(p,null,y(V.value,a=>(h(),n("option",{key:a.id,value:a.id},o(a.name),9,He))),128))],512),[[v,q.value.sales_id]])]),i("div",Je,[i("button",{type:"button",onClick:D,class:"btn btn-outline"}," å–æ¶ˆ "),i("button",{type:"submit",class:"btn btn-primary",disabled:P.value},o(P.value?"è™•ç†ä¸­...":L.value?"æ–°å¢":"æ›´æ–°"),9,Ke)])],32)])])):c("",!0),k(Ie,{visible:A.value,customer:S.value,onClose:T,onUpdated:E},null,8,["visible","customer"])]))}}),[["__scopeId","data-v-9f115176"]]);export{Oe as default};
